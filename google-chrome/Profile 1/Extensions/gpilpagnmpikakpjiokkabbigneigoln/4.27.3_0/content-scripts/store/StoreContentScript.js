(()=>{"use strict";let e=e=>crypto.getRandomValues(new Uint8Array(e));class t{static get(){return chrome}}var n=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};const o="@ANONYMOUS_ID_KEY",i="@SESSION_ID_KEY",r="@GEO",s="@MUTE_KEY",c="@CASHBACK_KEY",a="@ACT_STATE",d="@ACT_KEY",l="@ACT_COUPONS",u="@ACT_COUPON_INDEX",h="@ACT_ORIGINAL_PRICE",y="@ACT_BEST_COUPON_PRICE",f="@ACT_BEST_COUPON_NAME",p="@ACT_DISCOUNT_PRICES",v="@TAB_WIDGET_VERTICAL_POSITION",m="@CASHBACK_SHOW_SUCCESS_POPUP",g="@TAB_WIDGET_DISABLE_TOGGLE_KEY";class w{static set(e,o){return n(this,void 0,void 0,(function*(){return yield t.get().storage.local.set({[e]:o}),o}))}static get(e){return n(this,void 0,void 0,(function*(){const n=yield t.get().storage.local.get(e);if(n)return n[e]}))}static remove(e){return n(this,void 0,void 0,(function*(){return t.get().storage.local.remove(e)}))}static clear(){return n(this,void 0,void 0,(function*(){return t.get().storage.local.clear()}))}}const _="4.27.3";class E{static logEvent(e,t,n){var o,i,r,s,c;return i=this,r=void 0,c=function*(){try{const i=yield S.generateAnonymousId();yield fetch("https://europe-west2-qoala-analytics.cloudfunctions.net/logEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_name:t,uid:null!==(o=null==e?void 0:e.uid)&&void 0!==o?o:"",anonymous_id:i,platform:"chrome-extension",version:_,test:!1,event_properties:n})})}catch(e){console.log(e)}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{a(c.next(e))}catch(e){t(e)}}function o(e){try{a(c.throw(e))}catch(e){t(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(n,o)}a((c=c.apply(i,r||[])).next())}))}}var k=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};const x="Coupon Trial Failed",b="cashback";class S{static generateAnonymousId(){return k(this,void 0,void 0,(function*(){const t=((t,n=21)=>((e,t,n)=>{let o=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*o*t/e.length);return(r=t)=>{let s="";for(;;){let t=n(i),c=i;for(;c--;)if(s+=e[t[c]&o]||"",s.length===r)return s}}})(t,n,e))("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",21);let n=yield w.get(o);return n||(n=t(),yield w.set(o,n)),n}))}static logEvent(e,t,n){return k(this,void 0,void 0,(function*(){try{yield E.logEvent(e,t,n)}catch(e){console.log(e)}}))}static getSessionId(){return k(this,void 0,void 0,(function*(){let e=yield w.get(i);return e?e+36e5<Date.now()?(e=Date.now(),yield w.set(i,e),e.toString()):e.toString():(e=Date.now(),yield w.set(i,e),e.toString())}))}}const C="https://qoala-api-7adzuf62ma-nw.a.run.app/",P=JSON.parse('["google.com","google.es","marca.com","twitter.com","as.com","wikipedia.org","elmundo.es","instagram.com","elpais.com","sport.es","20minutes.es","mundodeportivo.com","elespanol.com","youtube.com","facebook.com","twitch.com","twitch.tv","linkedin.com","msn.com","pornhub.com","whatsapp.com","yahoo.com","xvideos.com","onlyfans.com","netflix.com","tiktok.com"]');var T=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};const A="@CREATE_TAB_MESSAGE",O="@BROWSER_ICON_TEXT_MESSAGE",I="@CASHBACK_POPUP_CLOSE_MESSAGE",R="@ACT_START_MESSAGE";class B{static send(e,n){return T(this,void 0,void 0,(function*(){return new Promise(((o,i)=>{t.get().runtime.sendMessage({id:e,payload:n},(e=>{o(e)}))}))}))}static sendDOMMessage(e,t){return T(this,void 0,void 0,(function*(){return window.parent.postMessage({id:e,payload:t},"*")}))}}class L{static fetch(e,t){return n=this,o=void 0,r=function*(){return B.send("@FETCH_REQUEST_MESSAGE",{url:e,request:t})},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,c)}a((r=r.apply(n,o||[])).next())}));var n,o,i,r}}var N=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class U{constructor(e,t,n){this.timestamp=e,this.exp=t,this.data=n}static get(e){return N(this,void 0,void 0,(function*(){const t=yield w.get(e.join());if(t)return t.exp>Date.now()?t.data:void 0}))}static write(e,t,n=3e4){return N(this,void 0,void 0,(function*(){return w.set(e.join(),{timestamp:Date.now(),exp:Date.now()+n,data:t})}))}static fetch(e,t,n=3e4){return N(this,void 0,void 0,(function*(){if(!e)return;const o=yield U.get(e);if(o)return o;const i=yield t();return(yield U.write(e,i,n)).data}))}}var F=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class D{static get(){return F(this,void 0,void 0,(function*(){return(yield w.get(r))||"es"}))}static set(e="es"){return F(this,void 0,void 0,(function*(){return w.set(r,e)}))}}var $=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class M{constructor(e,t,n,o,i,r,s,c,a,d,l,u,h,y,f,p,v,m,g,w,_,E){this._id=e,this.active=t,this.joined=n,this.hide_extension_popups=o,this.advertiser_id=i,this.advertiser_name=r,this.host=s,this.geos=c,this.allowed_hostnames=a,this.hide_platforms=d,this.network=l,this.tracking_url=u,this.category=h,this.checkout_url_keyword=y,this.success_url_keyword=f,this.peer_keywords=p,this.cashback=v,this.autofill=m,this.coupon_tester=g,this.epic_qoins=w,this.logo=_,this.banner=E}static query(e){return $(this,void 0,void 0,(function*(){const t=yield D.get(),n=["@ADVERTISER_KEY",e.host,e.hostname,t];if(e.hostname&&P.find((t=>{var n;return t.includes(null!==(n=null==e?void 0:e.hostname)&&void 0!==n?n:"")})))throw Error("Advertiser in blacklist.");return U.fetch(n,(()=>$(this,void 0,void 0,(function*(){const n=new URL(`${C}networkAdvertisers?geo=${t.toLowerCase()}`);Object.entries(e).forEach((e=>{e[1]&&n.searchParams.append(e[0],String(e[1]))}));const o=yield L.fetch(n.toString(),{method:"GET"});if(!o.success)throw new Error("Error getting advertiser.");if(o.data)return o.data[0]}))),3e5)}))}}var q=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class G{constructor(e,t,n,o,i,r,s){this.uid=e,this.anonymous_id=t,this.email=n,this.name=o,this.createdAt=i,this.photoUrl=r,this.token=s}static get(){return q(this,void 0,void 0,(function*(){return w.get("@AUTH_KEY")}))}static refreshToken(){var e;return q(this,void 0,void 0,(function*(){const t=yield G.get();return(new URLSearchParams).set("data",JSON.stringify({grant_type:"refresh_token",refresh_token:null==t?void 0:t.token})),(yield L.fetch("https://securetoken.googleapis.com/v1/token?key=AIzaSyDgoYNNtBEjkKS3BwzYvYsuD0-CrdyyXJY",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:null!==(e=null==t?void 0:t.token)&&void 0!==e?e:""}).toString()})).id_token}))}}class H{static send(e,t,n){return o=this,i=void 0,s=function*(){try{if(!n.epic_qoins.enabled)return;const o=yield D.get(),i=yield G.get();if(!i)return;const r=yield G.refreshToken(),s=yield L.fetch("https://europe-west2-qoala-648cc.cloudfunctions.net/EpicTransactionHandler",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({id:n._id,uid:i.uid,platform:"chrome-extension",version:_,geo:o,click_id:e,session_id:t,test:!1})});if(!s.success)throw new Error("Error sending Epic Transaction.");return s.data}catch(e){console.error(e)}},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,c)}a((s=s.apply(o,i||[])).next())}));var o,i,r,s}}var K=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class j{constructor(e,t,n){this.host=e,this.exp=t,this.clickId=n}static set(e,t){return K(this,void 0,void 0,(function*(){return w.set(c,{host:e,exp:Date.now()+18e5,clickId:t})}))}static get(){return K(this,void 0,void 0,(function*(){return w.get(c)}))}static isActive(e){return K(this,void 0,void 0,(function*(){const t=yield w.get(c);return!!t&&t.host===e&&t.exp>Date.now()}))}}class z{static log(e,t){return n=this,o=void 0,r=function*(){const n=yield G.get();return B.send("@EVENT_LOG_MESSAGE",{auth:n,eventName:e,eventProperties:t})},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,c)}a((r=r.apply(n,o||[])).next())}));var n,o,i,r}}class Y{static create(e){return t=this,n=void 0,i=function*(){return yield L.fetch("https://qoala-linktrack-prod-7adzuf62ma-no.a.run.app/clicks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url,current_url:e.current_url,uid:e.uid,anonymous_id:e.anonymous_id,deal_id:e.offer_id,host:e.host,network_id:e.network_id,advertiser_id:e.advertiser_id,advertiser_name:e.advertiser_name,context:e.context,platform:"chrome-extension",session:yield S.getSessionId(),version:_})})},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}}var V=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class J{static open(e,t=!1){return V(this,void 0,void 0,(function*(){return B.send(A,{url:e,pinned:t})}))}static redirectFromWindowContext(e,t){window&&(console.info("Redirecting from window context",e,t),t?window.location.href=e:window.open(e))}static openTrackingUrl(e,t,n=!0,o=!1){var i;return V(this,void 0,void 0,(function*(){const r=yield G.get(),s=yield S.generateAnonymousId();let c={id:"",url:e,redirect_url:e};try{c=yield Y.create({url:e,current_url:t.current_url,uid:null!==(i=null==r?void 0:r.uid)&&void 0!==i?i:"",anonymous_id:s,host:t.host,network_id:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:t.context,offer_id:t.offer_id})}catch(e){console.log(e)}yield j.set(t.host,c.id);try{yield z.log("Link Clicked",{host:t.host,network:t.network,category:t.category,context:t.context,url:c.url,click_id:c.id,deal_id:t.offer_id,type:t.type})}catch(e){console.log(e)}yield w.set(m,!0),n?(setTimeout((()=>{J.redirectFromWindowContext(c.redirect_url,n)}),5e3),yield B.send("@UPDATE_TAB_MESSAGE",{url:c.redirect_url})):yield B.send(A,{url:c.redirect_url,pinned:o})}))}}var W=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class X{constructor(e,t){this.host=e,this.exp=t}static mute(e,t=18e5){return W(this,void 0,void 0,(function*(){return w.set([s,e].join(),{host:e,exp:Date.now()+t})}))}static isMuted(e){return W(this,void 0,void 0,(function*(){if(yield w.get("@DEV_MUTE_FLAG"))return!1;const t=yield w.get([s,e].join());return!!t&&t.exp>Date.now()}))}}const Q={primary:{default:"#FB8500",_dark:"#FB8500"},primaryHover:{default:"#fcaa4d",_dark:"#fcaa4d"},primarySurface:{default:"#ffebd6",_dark:"#7e4300"},secondary:{default:"#00b491",_dark:"#4dcbb2"},secondaryHover:{default:"#4dcbb2",_dark:"#00755F"},secondarySurface:{default:"#e8f5e4",_dark:"#00755F"},surface:{default:"#FFFFFF",_dark:"#121212"},surfaceVariant:{default:"#F7F5F6",_dark:"#292929"},surfaceTertiary:{default:"#ededed",_dark:"#3d3d3d"},onSurface:{default:"#242526",_dark:"#FFFFFF"},onSurfaceVariant:{default:"#646567",_dark:"#B2B3B3"},blueAccent:{default:"#34afcc",_dark:"#34afcc"},blueAccentSurface:{default:"#e8f1fa",_dark:"#22788C"},error:{default:"#FF6A6A",_dark:"#FF6A6A"},delete:{default:"#F07B72",_dark:"#F07B72"},approved:{default:"#e8f5e4",_dark:"#00755F"},pending:{default:"#ffebd6",_dark:"#7e4300"},declined:{default:"#FFD8D8",_dark:"#FF6A6A"},yellowAccent:{default:"#FBEB7A",_dark:"#FBEB7A"},yellowAccentSurface:{default:"#fff8dc",_dark:"#FB8500"},progressBar:{100:"#fdb666",200:"#fcaa4d",300:"#fc9d33",400:"#fb9119",500:"#FB8500",600:"#e27800",700:"#c96a00",800:"#b05d00",900:"#975000"}};var Z,ee=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class te{constructor(e,t,n,o,i,r,s,c,a,d,l,u){this.id=e,this.created_at=t,this.qoins=n,this.is_transactor=o,this.inactive_cashback_user=i,this.really_inactive_user=r,this.qoala_code=s,this.country=c,this.trees_amount=a,this.is_enterprise=d,this.power_user=l,this.cashback_multiplier=u}static get(e){return ee(this,void 0,void 0,(function*(){const t=["@USER_KEY",e];return U.fetch(t,(()=>ee(this,void 0,void 0,(function*(){const t=yield G.refreshToken();return yield L.fetch(`${C}users/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})}))),3e4)}))}static getFollowing(e){return ee(this,void 0,void 0,(function*(){const t=yield G.refreshToken(),n=yield L.fetch(`${C}users/${e}/following`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.success)throw new Error("Error getting following.");return n.data}))}static addFollowing(e,t){return ee(this,void 0,void 0,(function*(){const n=yield G.refreshToken(),o=yield L.fetch(`${C}users/${e}/following`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({host:t.host,advertiser_name:t.advertiser_name})});if(!o.success)throw new Error("Error getting following.");return o.data}))}static removeFollowing(e,t){return ee(this,void 0,void 0,(function*(){const n=yield G.refreshToken(),o=yield L.fetch(`${C}users/${e}/following/${t.host}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!o.success)throw new Error("Error getting following.");return o.data}))}static getAllTransactions(e,t,n=0,o,i,r){return ee(this,void 0,void 0,(function*(){const s=yield G.refreshToken(),c=yield L.fetch(`${C}users/${e}/transactions?offset=${n}&limit=${t}${o?"&type="+o:""}${i?`&status=${i}`:""}${r?`&exclude=${r}`:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!c.success)throw new Error("Error getting user.");return c.data}))}}!function(e){e.TRENDING="Trending",e.CASHBACK="Cashback",e.BIG_POPPA="Big Poppa",e.NON_TRANSACTOR_CASHBACK="Non Transactor Cashback",e.TOGGLE_CASHBACK="Toggle Cashback",e.STORE_DETAIL="Store Detail",e.SEARCH="Search",e.SEARCH_TAG="Search Tag",e.PEER_POPUP="Peer Popup",e.COUPON_TESTER_POPUP="Coupon Tester Popup"}(Z||(Z={}));var ne=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class oe{static get(){var e;return ne(this,void 0,void 0,(function*(){return null!==(e=yield U.fetch(["@WHITELIST_KEY"],(()=>ne(this,void 0,void 0,(function*(){var e;const t=yield L.fetch(`${C}v4/advertisers/whitelist`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t)throw new Error("Error getting whitelist.");const n=t;if(!n.data)throw new Error("Error getting whitelist.");return null!==(e=n.data.whitelist)&&void 0!==e?e:[]}))),216e5))&&void 0!==e?e:[]}))}}var ie=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};class re{constructor(e,t){this.host=e,this.exp=t}static set(e){return ie(this,void 0,void 0,(function*(){return yield w.set(d,{host:e,exp:Date.now()+9e5})}))}static get(){return ie(this,void 0,void 0,(function*(){return yield w.get(d)}))}static wasActivated(e){return ie(this,void 0,void 0,(function*(){const t=yield w.get(d);return!!t&&t.host===e&&t.exp>Date.now()}))}}var se=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))},ce=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};function ae(e,{timeOut:t=5e3,completeIfPresent:n=!0,attributes:o=!1}={timeOut:5e3,completeIfPresent:!0,attributes:!1}){return ce(this,void 0,void 0,(function*(){return yield new Promise((i=>{const r="selector"===de(e)?document.querySelector(e):document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(r&&n)return void i(r);const s=new MutationObserver(((t,n)=>{for(const r of t){if("childList"===r.type)for(const t of r.addedNodes)try{const o="selector"===de(e)?t.querySelector(e):document.evaluate(e,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=o?o:t.matches(e))return i(null!=o?o:t),void n.disconnect()}catch(e){console.error(e)}if("attributes"===r.type&&o)try{const t="selector"===de(e)?r.target.querySelector(e):document.evaluate(e,r.target,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(null!=t?t:r.target.matches(e))return i(null!=t?t:r.target),void n.disconnect()}catch(e){console.error(e)}}}));s.observe(document.body,{childList:!0,subtree:!0,attributes:o}),setTimeout((()=>{s.disconnect(),i("Element Not Found")}),t)}))}))}function de(e){return/^\/\//.test(e)?"xpath":"selector"}function le(e){return e.replace(/[^0-9,\.]/g,"")}function ue(e,t){return n=this,o=void 0,r=function*(){if(e.value=t,!e.dispatchEvent(new Event("change",{bubbles:!0})))throw new Error(`Could not set value ${t} on node ${e}`)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{a(r.next(e))}catch(e){t(e)}}function c(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,c)}a((r=r.apply(n,o||[])).next())}));var n,o,i,r}const he={click:function(e){return t=this,n=void 0,i=function*(){if(!e.dispatchEvent(new MouseEvent("click",{bubbles:!0})))throw new Error(`Could not click on node ${e}`)},new((o=void 0)||(o=Promise))((function(e,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function c(e){try{a(i.throw(e))}catch(e){r(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,c)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i},select:function(e,t,n=((e,t)=>e.innerHTML.includes(t))){return o=this,i=void 0,s=function*(){const o=e.options;for(let i=0;i<o.length;i++)if(n(o[i],t))return ue(e,o[i].value);throw new Error(`Could not set value ${t} on select ${e}`)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,c)}a((s=s.apply(o,i||[])).next())}));var o,i,r,s},type:function(e,t,n=50){return o=this,i=void 0,s=function*(){e.focus();for(const o of t){const t=new KeyboardEvent("keydown",{key:o,bubbles:!0}),i=new InputEvent("input",{data:o,bubbles:!0}),r=new KeyboardEvent("keyup",{key:o,bubbles:!0});e.value+=o,e.dispatchEvent(t),e.dispatchEvent(i),e.dispatchEvent(r),yield new Promise((e=>setTimeout(e,n)))}const o=new Event("change",{bubbles:!0});e.dispatchEvent(o)},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,c)}a((s=s.apply(o,i||[])).next())}));var o,i,r,s},write:ue,waitForValue:function(e,t,n=4e3){return o=this,i=void 0,s=function*(){return new Promise(((o,i)=>{e.value===t&&o();const r=new MutationObserver((function(e){e.forEach((function(e){e.target instanceof HTMLInputElement&&"attributes"===e.type&&"value"===e.attributeName&&e.target.value===t&&(r.disconnect(),o())}))}));r.observe(e,{attributes:!0,attributeFilter:["value"]}),setTimeout((()=>{r.disconnect(),i(new Error(`Element ${e.id} not filled with value ${t} within ${n}ms`))}),n)}))},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{a(s.next(e))}catch(e){t(e)}}function c(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,c)}a((s=s.apply(o,i||[])).next())}));var o,i,r,s}};var ye=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};const fe="READY",pe="TESTING",ve="TEST_FINISHED",me="FAILED",ge="Real ACT",we="Fake ACT",_e="Sleek ACT",Ee={tiendanimal:{entrypoint:'div.desk-view input[id="couponCode"]',ACTConfig:{coupon_input:'div.desk-view input[id="couponCode"]',submit_input:"div.desk-view button.promo-code-btn",error_selector:"div.desk-view span.coupon-error-message",success_selector:"div.desk-view div.coupons-and-promos section.is-success",original_price_selector:"div.desk-view p.grand-total",discount_price_selector:"div.desk-view p.grand-total",prices_use_comma:!1,is_simple:!0,remove_coupon_selector:"div.desk-view button.remove-coupon.coupon-alert-valid"}}};var ke=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{a(o.next(e))}catch(e){r(e)}}function c(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))};const xe=new class{constructor(){}start(e,t){return ye(this,void 0,void 0,(function*(){console.log("Start Coupon Tester...");try{const t=document.querySelector(e.original_price_selector),n=null==t?void 0:t.innerHTML.replace("€","").trim();if(n){let t=le(n);e.prices_use_comma&&(t=t.replace(/\./g,""),t=t.replace(/\,/g,".")),yield w.set(h,t),yield ae(e.coupon_input)}}catch(e){yield z.log(x,{host:t.host,error:e})}}))}saveDiscount(e,t,n,o){return ye(this,void 0,void 0,(function*(){try{const i=document.querySelector(t.discount_price_selector);if(i){let r=le(i.innerHTML.replace("€","").trim());t.prices_use_comma&&(r=r.replace(/\./g,""),r=r.replace(/\,/g,"."));const s=yield w.get(p);if(s){const e=JSON.parse(s);e.push({coupon:n[o].code,price:parseFloat(r)}),yield w.set(p,JSON.stringify(e))}else yield w.set(p,JSON.stringify([{coupon:n[o].code,price:parseFloat(r)}]));const c=o+1;yield w.set(u,c),window.parent.postMessage({id:R,payload:{coupons:n,advertiser:e}},"*")}}catch(t){yield z.log(x,{host:e.host,error:t})}}))}testCoupon(e,t,n,o){return ye(this,void 0,void 0,(function*(){if(void 0!==t)try{yield w.set(a,{state:pe,host:e.host,type:ge}),0===o&&(yield this.start(t,e)),"Element Not Found"!==(yield ae(t.success_selector,{timeOut:1500}))&&(yield this.removeCoupon(t,e)),yield w.set(u,o);const i=n.length>10?10:n.length;if(o+1>i){const o=yield this.compareDiscounts(e);return o?void(yield this.applyBestDiscount(t,e,n,o)):void 0===o?(yield w.set(a,{state:"TEST_FINISHED_FAILED",host:e.host,type:ge}),void(yield J.openTrackingUrl(e.tracking_url,{host:e.host,network:e.network,advertiser_id:e.advertiser_id,advertiser_name:e.advertiser_name,context:Z.COUPON_TESTER_POPUP,category:e.category,type:b},!1,!0).then().catch((()=>{console.log("Error opening the Link URL")})))):void 0}const r=document.querySelector(t.coupon_input);r.value="",yield he.write(r,"");const s=document.querySelector(t.submit_input);if(yield he.write(r,n[o].code),yield he.click(s),"Element Not Found"!==(yield ae(t.success_selector,{timeOut:1800})))yield this.saveDiscount(e,t,n,o);else{const i=o+1;yield w.set(u,i),yield this.removeCoupon(t,e),window.parent.postMessage({id:R,payload:{coupons:n,advertiser:e}},"*")}}catch(t){console.log(t),yield z.log(x,{host:e.host,error:t}),yield w.set(a,{state:me,host:e.host,type:ge})}}))}removeCoupon(e,t){return ye(this,void 0,void 0,(function*(){try{if(e.remove_coupon_selector){const t=yield ae(e.remove_coupon_selector,{timeOut:1e3});t&&"Element Not Found"!==t&&(yield he.click(t),yield function(e){return ce(this,void 0,void 0,(function*(){yield new Promise((t=>{if(!document.querySelector(e))return t(),!0;const n=new MutationObserver((o=>{for(const i of o)"childList"!==i.type||document.querySelector(e)||(n.disconnect(),t())}));n.observe(document.body,{childList:!0,subtree:!0})}))}))}(e.success_selector))}}catch(e){console.log(e),yield z.log(x,{host:t.host,error:e}),yield w.set(a,{state:me,host:t.host,type:ge})}}))}compareDiscounts(e){return ye(this,void 0,void 0,(function*(){try{const e=yield w.get(p);if(e){const t=JSON.parse(e),n=t.reduce(((e,t)=>t.price<e.price?t:e),t[0]);return yield w.set(y,n.price),yield w.set(f,n.coupon),n}}catch(t){console.log(t),yield z.log(x,{host:e.host,error:t})}}))}applyBestDiscount(e,t,n,o){return ye(this,void 0,void 0,(function*(){try{const n=yield ae(e.coupon_input),i=document.querySelector(e.submit_input);n||i||(console.log("Inputs were not found..."),yield w.set(a,{state:me,host:t.host,type:ge})),n.value="",yield he.write(n,o.coupon),yield he.click(i),yield w.set(a,{state:ve,host:t.host,type:ge})}catch(e){console.log(e),yield z.log(x,{host:t.host,error:e}),yield w.set(a,{state:me,host:t.host,type:ge})}}))}startSleekACT(e,t){return ye(this,void 0,void 0,(function*(){console.log("Start Sleek Coupon Tester...");try{yield w.set(a,{state:pe,host:e.host,type:_e})}catch(t){console.log(t),yield z.log(x,{host:e.host,error:t}),yield w.set(a,{state:me,host:e.host,type:_e})}}))}},be="qla-qoala-cashback-container",Se="qla-qoala-tab-widget-container",Ce="qla-qoala-checkout-container",Pe="qla-qoala-success-container",Te="qla-qoala-redirect-container",Ae="qla-qoala-peer-container",Oe="qla-qoala-act-container",Ie=64;function Re(e,n,o){return ke(this,void 0,void 0,(function*(){const i=document.createElement("iframe");i.id=be,i.style.all="unset",i.style.position="fixed",i.style.top=o?`${o}px`:"0",i.style.right="0",i.style.width="400px",i.style.height="450px",i.style.margin="16px",i.style.borderRadius="8px",i.style.zIndex="2147483647",i.style.background="none transparent",i.style.backgroundColor="none transparent",i.src=t.get().runtime.getURL(`content-scripts/store/cashbackPopup/CashbackPopup.html?hostname=${e}&context=${n}`),document.getElementById(be)||document.body.appendChild(i)}))}function Be(e){const n=document.createElement("iframe");n.id=Oe,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="380px",n.style.height="1000px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=t.get().runtime.getURL(`content-scripts/store/actPopup/ACTPopup.html?host=${e.host}`),document.getElementById(Oe)||document.body.appendChild(n)}function Le(e){return ke(this,void 0,void 0,(function*(){console.log("Landed in Checkout page..."),function(e){var t;ke(this,void 0,void 0,(function*(){if(!(yield G.get()))return;if(!(null===(t=e.coupon_tester)||void 0===t?void 0:t.enabled))return;const n=yield re.wasActivated(e.host),o=yield w.get(a);yield function(e,t,n){return ke(this,void 0,void 0,(function*(){if((null==n?void 0:n.state)===pe&&!t){const t=yield w.get(l);Be(e),window.parent.postMessage({id:R,payload:{coupons:t,advertiser:e}},"*")}if((null==n?void 0:n.state)===ve&&(null==n?void 0:n.host)===e.host&&!t)return J.openTrackingUrl(e.tracking_url,{host:e.host,network:e.network,advertiser_id:e.advertiser_id,advertiser_name:e.advertiser_name,context:Z.COUPON_TESTER_POPUP,category:e.category,type:b},!1,!0).then().catch((()=>{console.log("Error opening the Link URL")})),void Be(e);const o=new MutationObserver(((n,o)=>ke(this,void 0,void 0,(function*(){var n;if(null===(n=Ee[e.host])||void 0===n?void 0:n.entrypoint){const n=yield w.get(a);(null==n?void 0:n.state)===pe||t||(yield function(){return ke(this,void 0,void 0,(function*(){yield w.remove(f),yield w.remove(y),yield w.remove(u),yield w.remove(p),yield w.remove(h)}))}(),yield w.set(a,{state:fe,host:e.host,type:ge}))}else yield w.set(a,{state:fe,host:e.host,type:we});Be(e),o.disconnect()}))));o.observe(document.documentElement,{attributes:!1,childList:!0,subtree:!0})}))}(e,n,o)}))}(e)}))}function Ne(e){return ke(this,void 0,void 0,(function*(){const n=window.location.hostname;if((yield w.get(g))||(yield function(e){return ke(this,void 0,void 0,(function*(){const n=document.createElement("div");let o=yield w.get(v);o||(o=window.innerHeight/3,yield w.set(v,o));const i=yield j.isActive(e.host);n.id=Se,n.style.all="unset",n.style.position="fixed",n.style.width="104px",n.style.height=`${Ie}px`,n.style.right="0px",n.style.boxShadow="0px 0px 16px #00000038",n.style.borderTopLeftRadius="8px",n.style.borderBottomLeftRadius="8px",n.style.top=`${o}px`,n.style.zIndex="2147483647",n.style.transform="translate(24px)",n.style.backgroundColor=Q.primaryHover.default,n.addEventListener("mouseenter",(()=>{const e=document.getElementById(Se);e&&"translate(0px)"!==e.style.transform&&(e.style.transform="translate(0px)")})),n.addEventListener("mouseleave",(()=>{const e=document.getElementById(Se);e&&"translate(24px)"!==e.style.transform&&(e.style.transform="translate(24px)")}));const r=document.createElement("div");r.id=Se+"header",r.style.height="100%",r.style.width="24px",r.style.cursor="grab",r.style.display="flex",r.style.position="absolute",r.style.right="0",r.style.boxShadow="rgb(79 79 79) 4px 0px 4px inset",r.style.backgroundColor="rgb(103 103 103)";const s=document.createElement("img");s.style.width="14px",s.style.height="14px",s.style.alignSelf="center",s.style.margin="auto",s.src=t.get().runtime.getURL("assets/images/drag_icon.svg"),r.appendChild(s);const c=document.createElement("div");c.id=Se+"clickable",c.style.height="100%",c.style.width="80px",c.style.cursor="pointer",c.style.display="flex",c.style.borderTopLeftRadius="8px",c.style.borderBottomLeftRadius="8px",c.style.position="absolute",c.style.left="0",c.style.background=i?Q.secondary.default:"linear-gradient(90deg, rgba(251,133,0,1) 0%, rgba(252,170,77,1) 100%)";const a=document.createElement("img");a.id=Se+"image",a.style.width="46px",a.style.height="46px",a.style.alignSelf="center",a.style.margin="auto",a.src=t.get().runtime.getURL("assets/images/iconwhite128.png"),c.appendChild(a),n.appendChild(c),n.appendChild(r),document.getElementById(Se)||document.body.appendChild(n);const d=document.getElementById(Se);d&&function(e){let t=0,n=0;const o=document.getElementById(e.id+"image");o&&(o.onmouseenter=c,o.onmouseleave=function(){const e=document.getElementById(be);null==e||e.addEventListener("mouseover",(()=>{clearTimeout(t)})),null==e||e.addEventListener("mouseleave",(()=>{setTimeout((()=>{window.parent.postMessage({id:I},"*")}),500),e.removeEventListener("mouseover",(()=>{})),e.removeEventListener("mouseleave",(()=>{}))}));const t=setTimeout((()=>{window.parent.postMessage({id:I},"*")}),500)});const i=document.getElementById(e.id+"header");function r(e){var t;const i=e;i.preventDefault(),document.getElementById(be)&&(null===(t=document.getElementById(be))||void 0===t||t.remove()),n=i.clientY,document.onmouseup=a,document.onmousemove=s,o&&(o.onmouseenter=null)}function s(o){const i=o;i.preventDefault(),t=n-i.clientY,n=i.clientY;const r=e.offsetTop-t;r>=0&&r<window.innerHeight-Ie&&(e.style.top=`${r}px`)}function c(){var e;return ke(this,void 0,void 0,(function*(){const t=null!==(e=yield w.get(v))&&void 0!==e?e:0;Re(window.location.hostname,Z.TOGGLE_CASHBACK,(null!=t?t:0)+Ie)}))}function a(){i&&(i.style.backgroundColor="rgb(103 103 103)"),o&&(o.onmouseenter=c),document.onmouseup=null,document.onmousemove=null,w.set(v,e.offsetTop-t)}i?i.onmousedown=r:e.onmousedown=r}(d)}))}(e)),yield w.get(m))return yield function(e,n){return ke(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=Pe,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="330px",n.style.height="360px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=t.get().runtime.getURL(`content-scripts/store/successPopup/SuccessPopup.html?hostname=${e}`),document.getElementById(Pe)||document.body.appendChild(n)}))}(n),void(yield w.set(m,!1));if(!(yield X.isMuted(e.host))){let o;console.log("Cashback available! Displaying popup...");const i=yield G.get();i&&(o=yield te.get(i.uid)),(null==o?void 0:o.really_inactive_user)?yield function(e,n){return ke(this,void 0,void 0,(function*(){const o=document.createElement("iframe");o.id=be,o.style.all="unset",o.style.position="fixed",o.style.top="0",o.style.right="0",o.style.width="1400px",o.style.height="800px",o.style.margin="16px",o.style.borderRadius="8px",o.style.zIndex="2147483647",o.style.background="none transparent",o.style.backgroundColor="none transparent",o.src=t.get().runtime.getURL(`content-scripts/store/bigPoppa/BigPoppa.html?hostname=${e}&context=${n}`),document.getElementById(be)||document.body.appendChild(o)}))}(n,Z.BIG_POPPA):(null==o?void 0:o.is_transactor)?(null==o?void 0:o.inactive_cashback_user)?yield function(e,n,o){return ke(this,void 0,void 0,(function*(){const o=document.createElement("iframe");o.id=be,o.style.all="unset",o.style.position="fixed",o.style.top="0",o.style.right="0",o.style.width="400px",o.style.height="450px",o.style.margin="16px",o.style.borderRadius="8px",o.style.zIndex="2147483647",o.style.background="none transparent",o.style.backgroundColor="none transparent",o.src=t.get().runtime.getURL(`content-scripts/store/cashbackExpirationPopup/CashbackExpirationPopup.html?hostname=${e}&context=${n}`),document.getElementById(be)||document.body.appendChild(o)}))}(n,Z.CASHBACK):yield Re(n,Z.CASHBACK):yield function(e,n,o){return ke(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=be,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="700px",n.style.height="400px",n.style.margin="16px",n.style.borderRadius="8px",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=t.get().runtime.getURL(`content-scripts/store/nonTransactorCashbackPopup/NonTransactorCashbackPopup.html?hostname=${e}`),document.getElementById(be)||document.body.appendChild(n)}))}(n),yield X.mute(e.host)}}))}(new class{constructor(){this.endpoint="https://api.heisen.eu/shopping-intent/event",this.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U"}buildRequest(e){return se(this,void 0,void 0,(function*(){const t=yield G.get(),n=(null==t?void 0:t.uid)?null==t?void 0:t.uid:"";e=Object.assign(Object.assign({},e),{url:window.location.toString(),uid:n}),fetch(this.endpoint,{mode:"no-cors",headers:{Authorization:"Bearer "+this.token,Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)})}))}sendProdutVisitEvent(){return se(this,void 0,void 0,(function*(){const e=window.location.protocol+"//"+window.location.host+"/"+window.location.pathname.split("/")[1]+"/";["https://www.miravia.es/p/"].includes(e)&&(console.log("sendProdutVisitEvent"),this.buildRequest({type:"PRODUCT_VISIT"}))}))}sendMiraviaPlaceOrderEvent(){return se(this,void 0,void 0,(function*(){const e=new URLSearchParams(window.location.search).get("checkoutOrderId");if(e){console.log("sendMiraviaPlaceOrderEvent");const t={type:"ORDER_REFERENCE",order_reference:e};this.buildRequest(t)}}))}sendEvent(){return se(this,void 0,void 0,(function*(){this.sendProdutVisitEvent(),this.sendMiraviaPlaceOrderEvent()}))}}).sendEvent(),window.addEventListener("message",(function(e){var n,o,i,r,s,c,a,d,l,h;switch(e.data.id){case"@CASHBACK_POPUP_HIDE_MESSAGE":const y=document.getElementById(be);y&&(y.style.visibility="hidden");break;case I:null===(n=document.getElementById(be))||void 0===n||n.remove(),null===(o=document.getElementById(be))||void 0===o||o.remove();break;case"@CHECKOUT_POPUP_CLOSE_MESSAGE":null===(i=document.getElementById(Ce))||void 0===i||i.remove();break;case"@SUCCESS_POPUP_CLOSE_MESSAGE":null===(r=document.getElementById(Pe))||void 0===r||r.remove();break;case"@REDIRECT_POPUP_OPEN_MESSAGE":(function(e){return ke(this,void 0,void 0,(function*(){const n=document.createElement("iframe");n.id=Te,n.style.all="unset",n.style.position="fixed",n.style.top="0",n.style.right="0",n.style.width="100%",n.style.height="100%",n.style.zIndex="2147483647",n.style.background="none transparent",n.style.backgroundColor="none transparent",n.src=t.get().runtime.getURL(`content-scripts/store/redirectPopup/RedirectPopup.html?hostname=${e}`),document.getElementById(Te)||document.body.appendChild(n)}))})(window.location.hostname).then().catch();break;case"@PEER_POPUP_CLOSE_MESSAGE":null===(s=document.getElementById(Ae))||void 0===s||s.remove();break;case"@REDIRECT_POPUP_CLOSE_MESSAGE":null===(c=document.getElementById(Te))||void 0===c||c.remove();break;case"@RECEIPT_CLOSE_MESSAGE":null===(a=document.getElementById("qla-qoala-receipt-container"))||void 0===a||a.remove();break;case"@COUPON_TRIAL_POPUP_CLOSE_MESSAGE":null===(d=document.getElementById("qla-qoala-coupontrial-container"))||void 0===d||d.remove();break;case"@COUPON_TRIAL_POPUP_OPEN_MESSAGE":null===(l=document.getElementById(Ce))||void 0===l||l.remove();break;case"@ACT_POPUP_CLOSE_MESSAGE":{const{ACTType:t,advertiser:n}=e.data.payload;t&&z.log("Coupon Trial Cancelled",{host:n.host,type:t}),null===(h=document.getElementById(Oe))||void 0===h||h.remove();break}case R:{const{coupons:t,advertiser:n}=e.data.payload;!function(e,t){ke(this,void 0,void 0,(function*(){if(e.length>0){const n=yield w.get(u);n&&0!==n?yield xe.testCoupon(t,Ee[t.host].ACTConfig,e,n):yield xe.testCoupon(t,Ee[t.host].ACTConfig,e,0)}else console.log("Cannot start ACT...")}))}(t,n);break}case"@OPEN_TRACKING_URL_MESSAGE":{const{url:t,data:n,redirect:o,pinned:i}=e.data.payload;(function(e,t,n=!0,o=!1){return ke(this,void 0,void 0,(function*(){yield J.openTrackingUrl(e,{host:t.host,current_url:n?window.location.href:void 0,network:t.network,advertiser_id:t.advertiser_id,advertiser_name:t.advertiser_name,context:t.context,category:t.category,type:t.type,offer_id:t.offer_id},n,o)}))})(t,n,o,i).then().catch();break}}}),!1),t.get().runtime.onMessage.addListener((function(e){var t;e.id===I&&(null===(t=document.getElementById(be))||void 0===t||t.remove())})),function(){return ke(this,void 0,void 0,(function*(){const e=yield oe.get();let n=window.location.hostname;if(console.log(n),"www.computop-paygate.com"===n&&(n="mediamarkt.es"),"sis.redsys.es"===n&&(n="www.primor.eu"),e.includes(n)){console.log(`Finding deals for ${n}...`);const e=yield M.query({hostname:n,active:!0,joined:!0});if(!e)return void(yield B.send(O,{reset:!0}));if(e.hide_platforms.includes("Extension"))return;const o=yield j.isActive(e.host);yield B.send(O,{activeCashback:o});const i=yield re.wasActivated(e.host);!o&&!i&&e.tracking_url&&e.checkout_url_keyword&&window.location.href.includes(e.checkout_url_keyword)&&(yield Le(e)),e.cashback.active&&e.tracking_url&&(yield function(e){return ke(this,void 0,void 0,(function*(){e.success_url_keyword&&window.location.href.includes(e.success_url_keyword)?yield function(e){return ke(this,void 0,void 0,(function*(){console.log("Landed in Confirmation page...");const t=yield G.get(),n=yield j.isActive(e.host);if(t&&n){const t=yield S.getSessionId(),n=yield j.get();n&&(yield H.send(n.clickId,t,e)),z.log("Page Viewed",{page_name:"Store Success",page_data:{host:e.host,category:e.category,advertiser_id:e.advertiser_id,network:e.network}})}}))}(e):e.hide_extension_popups||(yield Ne(e))}))}(e)),e.peer_keywords&&(yield function(e){return ke(this,void 0,void 0,(function*(){const n=window.location.href,o=e.peer_keywords.find((e=>e.keywords.find((e=>n.includes(e)))));o&&!e.hide_extension_popups&&((yield X.isMuted(e.host))||function(e,n){ke(this,void 0,void 0,(function*(){const o=document.createElement("iframe");o.id=Ae,o.style.all="unset",o.style.position="fixed",o.style.top="0",o.style.right="0",o.style.width="350px",o.style.height="460px",o.style.margin="16px",o.style.borderRadius="8px",o.style.zIndex="2147483647",o.style.background="none transparent",o.style.backgroundColor="none transparent",o.src=t.get().runtime.getURL(`content-scripts/store/peerPopup/PeerPopup.html?hostname=${n}&title=${e.title}&offer_id=${e.offer_id}`),document.getElementById(Ae)||document.body.appendChild(o)}))}(o,window.location.hostname),yield X.mute(e.host))}))}(e))}}))}().then().catch()})();