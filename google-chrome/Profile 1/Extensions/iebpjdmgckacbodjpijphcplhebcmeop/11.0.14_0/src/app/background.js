"use strict";(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __require=(x=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(x,{get:(a,b)=>(typeof require<"u"?require:a)[b]}):x)(function(x){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+x+'" is not supported')});var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(let key of __getOwnPropNames(from))!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod));var require_localforage=__commonJS({"node_modules/localforage/dist/localforage.js"(exports,module){(function(f){if(typeof exports=="object"&&typeof module<"u")module.exports=f();else if(typeof define=="function"&&define.amd)define([],f);else{var g;typeof window<"u"?g=window:typeof global<"u"?g=global:typeof self<"u"?g=self:g=this,g.localforage=f()}})(function(){var define2,module2,exports2;return function e(t,n,r){function s(o2,u){if(!n[o2]){if(!t[o2]){var a=typeof __require=="function"&&__require;if(!u&&a)return a(o2,!0);if(i)return i(o2,!0);var f=new Error("Cannot find module '"+o2+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o2]={exports:{}};t[o2][0].call(l.exports,function(e2){var n2=t[o2][1][e2];return s(n2||e2)},l,l.exports,e,t,n,r)}return n[o2].exports}for(var i=typeof __require=="function"&&__require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module3,exports3){(function(global2){"use strict";var Mutation=global2.MutationObserver||global2.WebKitMutationObserver,scheduleDrain;if(Mutation){var called=0,observer=new Mutation(nextTick),element=global2.document.createTextNode("");observer.observe(element,{characterData:!0}),scheduleDrain=function(){element.data=called=++called%2}}else if(!global2.setImmediate&&typeof global2.MessageChannel<"u"){var channel=new global2.MessageChannel;channel.port1.onmessage=nextTick,scheduleDrain=function(){channel.port2.postMessage(0)}}else"document"in global2&&"onreadystatechange"in global2.document.createElement("script")?scheduleDrain=function(){var scriptEl=global2.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick(),scriptEl.onreadystatechange=null,scriptEl.parentNode.removeChild(scriptEl),scriptEl=null},global2.document.documentElement.appendChild(scriptEl)}:scheduleDrain=function(){setTimeout(nextTick,0)};var draining,queue=[];function nextTick(){draining=!0;for(var i,oldQueue,len=queue.length;len;){for(oldQueue=queue,queue=[],i=-1;++i<len;)oldQueue[i]();len=queue.length}draining=!1}module3.exports=immediate;function immediate(task){queue.push(task)===1&&!draining&&scheduleDrain()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(_dereq_,module3,exports3){"use strict";var immediate=_dereq_(1);function INTERNAL(){}var handlers={},REJECTED=["REJECTED"],FULFILLED=["FULFILLED"],PENDING=["PENDING"];module3.exports=Promise2;function Promise2(resolver){if(typeof resolver!="function")throw new TypeError("resolver must be a function");this.state=PENDING,this.queue=[],this.outcome=void 0,resolver!==INTERNAL&&safelyResolveThenable(this,resolver)}Promise2.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise2.prototype.then=function(onFulfilled,onRejected){if(typeof onFulfilled!="function"&&this.state===FULFILLED||typeof onRejected!="function"&&this.state===REJECTED)return this;var promise=new this.constructor(INTERNAL);if(this.state!==PENDING){var resolver=this.state===FULFILLED?onFulfilled:onRejected;unwrap(promise,resolver,this.outcome)}else this.queue.push(new QueueItem(promise,onFulfilled,onRejected));return promise};function QueueItem(promise,onFulfilled,onRejected){this.promise=promise,typeof onFulfilled=="function"&&(this.onFulfilled=onFulfilled,this.callFulfilled=this.otherCallFulfilled),typeof onRejected=="function"&&(this.onRejected=onRejected,this.callRejected=this.otherCallRejected)}QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)},QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)},QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)},QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)};function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}returnValue===promise?handlers.reject(promise,new TypeError("Cannot resolve promise with itself")):handlers.resolve(promise,returnValue)})}handlers.resolve=function(self2,value){var result=tryCatch(getThen,value);if(result.status==="error")return handlers.reject(self2,result.value);var thenable=result.value;if(thenable)safelyResolveThenable(self2,thenable);else{self2.state=FULFILLED,self2.outcome=value;for(var i=-1,len=self2.queue.length;++i<len;)self2.queue[i].callFulfilled(value)}return self2},handlers.reject=function(self2,error){self2.state=REJECTED,self2.outcome=error;for(var i=-1,len=self2.queue.length;++i<len;)self2.queue[i].callRejected(error);return self2};function getThen(obj){var then=obj&&obj.then;if(obj&&(typeof obj=="object"||typeof obj=="function")&&typeof then=="function")return function(){then.apply(obj,arguments)}}function safelyResolveThenable(self2,thenable){var called=!1;function onError(value){called||(called=!0,handlers.reject(self2,value))}function onSuccess(value){called||(called=!0,handlers.resolve(self2,value))}function tryToUnwrap(){thenable(onSuccess,onError)}var result=tryCatch(tryToUnwrap);result.status==="error"&&onError(result.value)}function tryCatch(func,value){var out={};try{out.value=func(value),out.status="success"}catch(e){out.status="error",out.value=e}return out}Promise2.resolve=resolve;function resolve(value){return value instanceof this?value:handlers.resolve(new this(INTERNAL),value)}Promise2.reject=reject;function reject(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)}Promise2.all=all;function all(iterable){var self2=this;if(Object.prototype.toString.call(iterable)!=="[object Array]")return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);for(var values=new Array(len),resolved=0,i=-1,promise=new this(INTERNAL);++i<len;)allResolver(iterable[i],i);return promise;function allResolver(value,i2){self2.resolve(value).then(resolveFromAll,function(error){called||(called=!0,handlers.reject(promise,error))});function resolveFromAll(outValue){values[i2]=outValue,++resolved===len&&!called&&(called=!0,handlers.resolve(promise,values))}}}Promise2.race=race;function race(iterable){var self2=this;if(Object.prototype.toString.call(iterable)!=="[object Array]")return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);for(var i=-1,promise=new this(INTERNAL);++i<len;)resolver(iterable[i]);return promise;function resolver(value){self2.resolve(value).then(function(response){called||(called=!0,handlers.resolve(promise,response))},function(error){called||(called=!0,handlers.reject(promise,error))})}}},{1:1}],3:[function(_dereq_,module3,exports3){(function(global2){"use strict";typeof global2.Promise!="function"&&(global2.Promise=_dereq_(2))}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(_dereq_,module3,exports3){"use strict";var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol=="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getIDB(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var idb=getIDB();function isIndexedDBValid(){try{if(!idb||!idb.open)return!1;var isSafari=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),hasFetch=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!isSafari||hasFetch)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function createBlob(parts,properties){parts=parts||[],properties=properties||{};try{return new Blob(parts,properties)}catch(e){if(e.name!=="TypeError")throw e;for(var Builder=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,builder=new Builder,i=0;i<parts.length;i+=1)builder.append(parts[i]);return builder.getBlob(properties.type)}}typeof Promise>"u"&&_dereq_(3);var Promise$1=Promise;function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}function executeTwoCallbacks(promise,callback,errorCallback){typeof callback=="function"&&promise.then(callback),typeof errorCallback=="function"&&promise.catch(errorCallback)}function normalizeKey(key2){return typeof key2!="string"&&(console.warn(key2+" used as a key, but it is not a string."),key2=String(key2)),key2}function getCallback(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var DETECT_BLOB_SUPPORT_STORE="local-forage-detect-blob-support",supportsBlobs=void 0,dbContexts={},toString=Object.prototype.toString,READ_ONLY="readonly",READ_WRITE="readwrite";function _binStringToArrayBuffer(bin){for(var length2=bin.length,buf=new ArrayBuffer(length2),arr=new Uint8Array(buf),i=0;i<length2;i++)arr[i]=bin.charCodeAt(i);return buf}function _checkBlobSupportWithoutCaching(idb2){return new Promise$1(function(resolve){var txn=idb2.transaction(DETECT_BLOB_SUPPORT_STORE,READ_WRITE),blob=createBlob([""]);txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob,"key"),txn.onabort=function(e){e.preventDefault(),e.stopPropagation(),resolve(!1)},txn.oncomplete=function(){var matchedChrome=navigator.userAgent.match(/Chrome\/(\d+)/),matchedEdge=navigator.userAgent.match(/Edge\//);resolve(matchedEdge||!matchedChrome||parseInt(matchedChrome[1],10)>=43)}}).catch(function(){return!1})}function _checkBlobSupport(idb2){return typeof supportsBlobs=="boolean"?Promise$1.resolve(supportsBlobs):_checkBlobSupportWithoutCaching(idb2).then(function(value){return supportsBlobs=value,supportsBlobs})}function _deferReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name],deferredOperation={};deferredOperation.promise=new Promise$1(function(resolve,reject){deferredOperation.resolve=resolve,deferredOperation.reject=reject}),dbContext.deferredOperations.push(deferredOperation),dbContext.dbReady?dbContext.dbReady=dbContext.dbReady.then(function(){return deferredOperation.promise}):dbContext.dbReady=deferredOperation.promise}function _advanceReadiness(dbInfo){var dbContext=dbContexts[dbInfo.name],deferredOperation=dbContext.deferredOperations.pop();if(deferredOperation)return deferredOperation.resolve(),deferredOperation.promise}function _rejectReadiness(dbInfo,err){var dbContext=dbContexts[dbInfo.name],deferredOperation=dbContext.deferredOperations.pop();if(deferredOperation)return deferredOperation.reject(err),deferredOperation.promise}function _getConnection(dbInfo,upgradeNeeded){return new Promise$1(function(resolve,reject){if(dbContexts[dbInfo.name]=dbContexts[dbInfo.name]||createDbContext(),dbInfo.db)if(upgradeNeeded)_deferReadiness(dbInfo),dbInfo.db.close();else return resolve(dbInfo.db);var dbArgs=[dbInfo.name];upgradeNeeded&&dbArgs.push(dbInfo.version);var openreq=idb.open.apply(idb,dbArgs);upgradeNeeded&&(openreq.onupgradeneeded=function(e){var db=openreq.result;try{db.createObjectStore(dbInfo.storeName),e.oldVersion<=1&&db.createObjectStore(DETECT_BLOB_SUPPORT_STORE)}catch(ex){if(ex.name==="ConstraintError")console.warn('The database "'+dbInfo.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+dbInfo.storeName+'" already exists.');else throw ex}}),openreq.onerror=function(e){e.preventDefault(),reject(openreq.error)},openreq.onsuccess=function(){var db=openreq.result;db.onversionchange=function(e){e.target.close()},resolve(db),_advanceReadiness(dbInfo)}})}function _getOriginalConnection(dbInfo){return _getConnection(dbInfo,!1)}function _getUpgradedConnection(dbInfo){return _getConnection(dbInfo,!0)}function _isUpgradeNeeded(dbInfo,defaultVersion){if(!dbInfo.db)return!0;var isNewStore=!dbInfo.db.objectStoreNames.contains(dbInfo.storeName),isDowngrade=dbInfo.version<dbInfo.db.version,isUpgrade=dbInfo.version>dbInfo.db.version;if(isDowngrade&&(dbInfo.version!==defaultVersion&&console.warn('The database "'+dbInfo.name+`" can't be downgraded from version `+dbInfo.db.version+" to version "+dbInfo.version+"."),dbInfo.version=dbInfo.db.version),isUpgrade||isNewStore){if(isNewStore){var incVersion=dbInfo.db.version+1;incVersion>dbInfo.version&&(dbInfo.version=incVersion)}return!0}return!1}function _encodeBlob(blob){return new Promise$1(function(resolve,reject){var reader=new FileReader;reader.onerror=reject,reader.onloadend=function(e){var base64=btoa(e.target.result||"");resolve({__local_forage_encoded_blob:!0,data:base64,type:blob.type})},reader.readAsBinaryString(blob)})}function _decodeBlob(encodedBlob){var arrayBuff=_binStringToArrayBuffer(atob(encodedBlob.data));return createBlob([arrayBuff],{type:encodedBlob.type})}function _isEncodedBlob(value){return value&&value.__local_forage_encoded_blob}function _fullyReady(callback){var self2=this,promise=self2._initReady().then(function(){var dbContext=dbContexts[self2._dbInfo.name];if(dbContext&&dbContext.dbReady)return dbContext.dbReady});return executeTwoCallbacks(promise,callback,callback),promise}function _tryReconnect(dbInfo){_deferReadiness(dbInfo);for(var dbContext=dbContexts[dbInfo.name],forages=dbContext.forages,i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db&&(forage._dbInfo.db.close(),forage._dbInfo.db=null)}return dbInfo.db=null,_getOriginalConnection(dbInfo).then(function(db){return dbInfo.db=db,_isUpgradeNeeded(dbInfo)?_getUpgradedConnection(dbInfo):db}).then(function(db){dbInfo.db=dbContext.db=db;for(var i2=0;i2<forages.length;i2++)forages[i2]._dbInfo.db=db}).catch(function(err){throw _rejectReadiness(dbInfo,err),err})}function createTransaction(dbInfo,mode,callback,retries){retries===void 0&&(retries=1);try{var tx=dbInfo.db.transaction(dbInfo.storeName,mode);callback(null,tx)}catch(err){if(retries>0&&(!dbInfo.db||err.name==="InvalidStateError"||err.name==="NotFoundError"))return Promise$1.resolve().then(function(){if(!dbInfo.db||err.name==="NotFoundError"&&!dbInfo.db.objectStoreNames.contains(dbInfo.storeName)&&dbInfo.version<=dbInfo.db.version)return dbInfo.db&&(dbInfo.version=dbInfo.db.version+1),_getUpgradedConnection(dbInfo)}).then(function(){return _tryReconnect(dbInfo).then(function(){createTransaction(dbInfo,mode,callback,retries-1)})}).catch(callback);callback(err)}}function createDbContext(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function _initStorage(options){var self2=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]=options[i];var dbContext=dbContexts[dbInfo.name];dbContext||(dbContext=createDbContext(),dbContexts[dbInfo.name]=dbContext),dbContext.forages.push(self2),self2._initReady||(self2._initReady=self2.ready,self2.ready=_fullyReady);var initPromises=[];function ignoreErrors(){return Promise$1.resolve()}for(var j=0;j<dbContext.forages.length;j++){var forage=dbContext.forages[j];forage!==self2&&initPromises.push(forage._initReady().catch(ignoreErrors))}var forages=dbContext.forages.slice(0);return Promise$1.all(initPromises).then(function(){return dbInfo.db=dbContext.db,_getOriginalConnection(dbInfo)}).then(function(db){return dbInfo.db=db,_isUpgradeNeeded(dbInfo,self2._defaultConfig.version)?_getUpgradedConnection(dbInfo):db}).then(function(db){dbInfo.db=dbContext.db=db,self2._dbInfo=dbInfo;for(var k=0;k<forages.length;k++){var forage2=forages[k];forage2!==self2&&(forage2._dbInfo.db=dbInfo.db,forage2._dbInfo.version=dbInfo.version)}})}function getItem(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_ONLY,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.get(key2);req.onsuccess=function(){var value=req.result;value===void 0&&(value=null),_isEncodedBlob(value)&&(value=_decodeBlob(value)),resolve(value)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_ONLY,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.openCursor(),iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var value=cursor.value;_isEncodedBlob(value)&&(value=_decodeBlob(value));var result=iterator(value,cursor.key,iterationNumber++);result!==void 0?resolve(result):cursor.continue()}else resolve()},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function setItem(key2,value,callback){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){var dbInfo;self2.ready().then(function(){return dbInfo=self2._dbInfo,toString.call(value)==="[object Blob]"?_checkBlobSupport(dbInfo.db).then(function(blobSupport){return blobSupport?value:_encodeBlob(value)}):value}).then(function(value2){createTransaction(self2._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName);value2===null&&(value2=void 0);var req=store.put(value2,key2);transaction.oncomplete=function(){value2===void 0&&(value2=null),resolve(value2)},transaction.onabort=transaction.onerror=function(){var err2=req.error?req.error:req.transaction.error;reject(err2)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function removeItem(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.delete(key2);transaction.oncomplete=function(){resolve()},transaction.onerror=function(){reject(req.error)},transaction.onabort=function(){var err2=req.error?req.error:req.transaction.error;reject(err2)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function clear(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_WRITE,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.clear();transaction.oncomplete=function(){resolve()},transaction.onabort=transaction.onerror=function(){var err2=req.error?req.error:req.transaction.error;reject(err2)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function length(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_ONLY,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.count();req.onsuccess=function(){resolve(req.result)},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function key(n,callback){var self2=this,promise=new Promise$1(function(resolve,reject){if(n<0){resolve(null);return}self2.ready().then(function(){createTransaction(self2._dbInfo,READ_ONLY,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),advanced=!1,req=store.openKeyCursor();req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(null);return}n===0||advanced?resolve(cursor.key):(advanced=!0,cursor.advance(n))},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function keys(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){createTransaction(self2._dbInfo,READ_ONLY,function(err,transaction){if(err)return reject(err);try{var store=transaction.objectStore(self2._dbInfo.storeName),req=store.openKeyCursor(),keys2=[];req.onsuccess=function(){var cursor=req.result;if(!cursor){resolve(keys2);return}keys2.push(cursor.key),cursor.continue()},req.onerror=function(){reject(req.error)}}catch(e){reject(e)}})}).catch(reject)});return executeCallback(promise,callback),promise}function dropInstance(options,callback){callback=getCallback.apply(this,arguments);var currentConfig=this.config();options=typeof options!="function"&&options||{},options.name||(options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName);var self2=this,promise;if(!options.name)promise=Promise$1.reject("Invalid arguments");else{var isCurrentDb=options.name===currentConfig.name&&self2._dbInfo.db,dbPromise=isCurrentDb?Promise$1.resolve(self2._dbInfo.db):_getOriginalConnection(options).then(function(db){var dbContext=dbContexts[options.name],forages=dbContext.forages;dbContext.db=db;for(var i=0;i<forages.length;i++)forages[i]._dbInfo.db=db;return db});options.storeName?promise=dbPromise.then(function(db){if(db.objectStoreNames.contains(options.storeName)){var newVersion=db.version+1;_deferReadiness(options);var dbContext=dbContexts[options.name],forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db=null,forage._dbInfo.version=newVersion}var dropObjectPromise=new Promise$1(function(resolve,reject){var req=idb.open(options.name,newVersion);req.onerror=function(err){var db2=req.result;db2.close(),reject(err)},req.onupgradeneeded=function(){var db2=req.result;db2.deleteObjectStore(options.storeName)},req.onsuccess=function(){var db2=req.result;db2.close(),resolve(db2)}});return dropObjectPromise.then(function(db2){dbContext.db=db2;for(var j=0;j<forages.length;j++){var _forage2=forages[j];_forage2._dbInfo.db=db2,_advanceReadiness(_forage2._dbInfo)}}).catch(function(err){throw(_rejectReadiness(options,err)||Promise$1.resolve()).catch(function(){}),err})}}):promise=dbPromise.then(function(db){_deferReadiness(options);var dbContext=dbContexts[options.name],forages=dbContext.forages;db.close();for(var i=0;i<forages.length;i++){var forage=forages[i];forage._dbInfo.db=null}var dropDBPromise=new Promise$1(function(resolve,reject){var req=idb.deleteDatabase(options.name);req.onerror=function(){var db2=req.result;db2&&db2.close(),reject(req.error)},req.onblocked=function(){console.warn('dropInstance blocked for database "'+options.name+'" until all open connections are closed')},req.onsuccess=function(){var db2=req.result;db2&&db2.close(),resolve(db2)}});return dropDBPromise.then(function(db2){dbContext.db=db2;for(var i2=0;i2<forages.length;i2++){var _forage=forages[i2];_advanceReadiness(_forage._dbInfo)}}).catch(function(err){throw(_rejectReadiness(options,err)||Promise$1.resolve()).catch(function(){}),err})})}return executeCallback(promise,callback),promise}var asyncStorage={_driver:"asyncStorage",_initStorage,_support:isIndexedDBValid(),iterate,getItem,setItem,removeItem,clear,length,key,keys,dropInstance};function isWebSQLValid(){return typeof openDatabase=="function"}var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",BLOB_TYPE_PREFIX="~~local_forage_type~",BLOB_TYPE_PREFIX_REGEX=/^~~local_forage_type~([^~]+)~/,SERIALIZED_MARKER="__lfsc__:",SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length,TYPE_ARRAYBUFFER="arbf",TYPE_BLOB="blob",TYPE_INT8ARRAY="si08",TYPE_UINT8ARRAY="ui08",TYPE_UINT8CLAMPEDARRAY="uic8",TYPE_INT16ARRAY="si16",TYPE_INT32ARRAY="si32",TYPE_UINT16ARRAY="ur16",TYPE_UINT32ARRAY="ui32",TYPE_FLOAT32ARRAY="fl32",TYPE_FLOAT64ARRAY="fl64",TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length,toString$1=Object.prototype.toString;function stringToBuffer(serializedString){var bufferLength=serializedString.length*.75,len=serializedString.length,i,p=0,encoded1,encoded2,encoded3,encoded4;serializedString[serializedString.length-1]==="="&&(bufferLength--,serializedString[serializedString.length-2]==="="&&bufferLength--);var buffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(buffer);for(i=0;i<len;i+=4)encoded1=BASE_CHARS.indexOf(serializedString[i]),encoded2=BASE_CHARS.indexOf(serializedString[i+1]),encoded3=BASE_CHARS.indexOf(serializedString[i+2]),encoded4=BASE_CHARS.indexOf(serializedString[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(encoded2&15)<<4|encoded3>>2,bytes[p++]=(encoded3&3)<<6|encoded4&63;return buffer}function bufferToString(buffer){var bytes=new Uint8Array(buffer),base64String="",i;for(i=0;i<bytes.length;i+=3)base64String+=BASE_CHARS[bytes[i]>>2],base64String+=BASE_CHARS[(bytes[i]&3)<<4|bytes[i+1]>>4],base64String+=BASE_CHARS[(bytes[i+1]&15)<<2|bytes[i+2]>>6],base64String+=BASE_CHARS[bytes[i+2]&63];return bytes.length%3===2?base64String=base64String.substring(0,base64String.length-1)+"=":bytes.length%3===1&&(base64String=base64String.substring(0,base64String.length-2)+"=="),base64String}function serialize(value,callback){var valueType="";if(value&&(valueType=toString$1.call(value)),value&&(valueType==="[object ArrayBuffer]"||value.buffer&&toString$1.call(value.buffer)==="[object ArrayBuffer]")){var buffer,marker=SERIALIZED_MARKER;value instanceof ArrayBuffer?(buffer=value,marker+=TYPE_ARRAYBUFFER):(buffer=value.buffer,valueType==="[object Int8Array]"?marker+=TYPE_INT8ARRAY:valueType==="[object Uint8Array]"?marker+=TYPE_UINT8ARRAY:valueType==="[object Uint8ClampedArray]"?marker+=TYPE_UINT8CLAMPEDARRAY:valueType==="[object Int16Array]"?marker+=TYPE_INT16ARRAY:valueType==="[object Uint16Array]"?marker+=TYPE_UINT16ARRAY:valueType==="[object Int32Array]"?marker+=TYPE_INT32ARRAY:valueType==="[object Uint32Array]"?marker+=TYPE_UINT32ARRAY:valueType==="[object Float32Array]"?marker+=TYPE_FLOAT32ARRAY:valueType==="[object Float64Array]"?marker+=TYPE_FLOAT64ARRAY:callback(new Error("Failed to get type for BinaryArray"))),callback(marker+bufferToString(buffer))}else if(valueType==="[object Blob]"){var fileReader=new FileReader;fileReader.onload=function(){var str=BLOB_TYPE_PREFIX+value.type+"~"+bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)},fileReader.readAsArrayBuffer(value)}else try{callback(JSON.stringify(value))}catch(e){console.error("Couldn't convert value into a JSON string: ",value),callback(null,e)}}function deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER)return JSON.parse(value);var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH),type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH),blobType;if(type===TYPE_BLOB&&BLOB_TYPE_PREFIX_REGEX.test(serializedString)){var matcher=serializedString.match(BLOB_TYPE_PREFIX_REGEX);blobType=matcher[1],serializedString=serializedString.substring(matcher[0].length)}var buffer=stringToBuffer(serializedString);switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return createBlob([buffer],{type:blobType});case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}var localforageSerializer={serialize,deserialize,stringToBuffer,bufferToString};function createDbTable(t,dbInfo,callback,errorCallback){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],callback,errorCallback)}function _initStorage$1(options){var self2=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]=typeof options[i]!="string"?options[i].toString():options[i];var dbInfoPromise=new Promise$1(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size)}catch(e){return reject(e)}dbInfo.db.transaction(function(t){createDbTable(t,dbInfo,function(){self2._dbInfo=dbInfo,resolve()},function(t2,error){reject(error)})},reject)});return dbInfo.serializer=localforageSerializer,dbInfoPromise}function tryExecuteSql(t,dbInfo,sqlStatement,args,callback,errorCallback){t.executeSql(sqlStatement,args,callback,function(t2,error){error.code===error.SYNTAX_ERR?t2.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[dbInfo.storeName],function(t3,results){results.rows.length?errorCallback(t3,error):createDbTable(t3,dbInfo,function(){t3.executeSql(sqlStatement,args,callback,errorCallback)},errorCallback)},errorCallback):errorCallback(t2,error)},errorCallback)}function getItem$1(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key2],function(t2,results){var result=results.rows.length?results.rows.item(0).value:null;result&&(result=dbInfo.serializer.deserialize(result)),resolve(result)},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function iterate$1(iterator,callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT * FROM "+dbInfo.storeName,[],function(t2,results){for(var rows=results.rows,length2=rows.length,i=0;i<length2;i++){var item=rows.item(i),result=item.value;if(result&&(result=dbInfo.serializer.deserialize(result)),result=iterator(result,item.key,i+1),result!==void 0){resolve(result);return}}resolve()},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function _setItem(key2,value,callback,retriesLeft){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){value===void 0&&(value=null);var originalValue=value,dbInfo=self2._dbInfo;dbInfo.serializer.serialize(value,function(value2,error){error?reject(error):dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key2,value2],function(){resolve(originalValue)},function(t2,error2){reject(error2)})},function(sqlError){if(sqlError.code===sqlError.QUOTA_ERR){if(retriesLeft>0){resolve(_setItem.apply(self2,[key2,originalValue,callback,retriesLeft-1]));return}reject(sqlError)}})})}).catch(reject)});return executeCallback(promise,callback),promise}function setItem$1(key2,value,callback){return _setItem.apply(this,[key2,value,callback,1])}function removeItem$1(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key2],function(){resolve()},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function clear$1(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function length$1(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t2,results){var result=results.rows.item(0).c;resolve(result)},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function key$1(n,callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t2,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function keys$1(callback){var self2=this,promise=new Promise$1(function(resolve,reject){self2.ready().then(function(){var dbInfo=self2._dbInfo;dbInfo.db.transaction(function(t){tryExecuteSql(t,dbInfo,"SELECT key FROM "+dbInfo.storeName,[],function(t2,results){for(var keys2=[],i=0;i<results.rows.length;i++)keys2.push(results.rows.item(i).key);resolve(keys2)},function(t2,error){reject(error)})})}).catch(reject)});return executeCallback(promise,callback),promise}function getAllStoreNames(db){return new Promise$1(function(resolve,reject){db.transaction(function(t){t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t2,results){for(var storeNames=[],i=0;i<results.rows.length;i++)storeNames.push(results.rows.item(i).name);resolve({db,storeNames})},function(t2,error){reject(error)})},function(sqlError){reject(sqlError)})})}function dropInstance$1(options,callback){callback=getCallback.apply(this,arguments);var currentConfig=this.config();options=typeof options!="function"&&options||{},options.name||(options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName);var self2=this,promise;return options.name?promise=new Promise$1(function(resolve){var db;options.name===currentConfig.name?db=self2._dbInfo.db:db=openDatabase(options.name,"","",0),options.storeName?resolve({db,storeNames:[options.storeName]}):resolve(getAllStoreNames(db))}).then(function(operationInfo){return new Promise$1(function(resolve,reject){operationInfo.db.transaction(function(t){function dropTable(storeName){return new Promise$1(function(resolve2,reject2){t.executeSql("DROP TABLE IF EXISTS "+storeName,[],function(){resolve2()},function(t2,error){reject2(error)})})}for(var operations=[],i=0,len=operationInfo.storeNames.length;i<len;i++)operations.push(dropTable(operationInfo.storeNames[i]));Promise$1.all(operations).then(function(){resolve()}).catch(function(e){reject(e)})},function(sqlError){reject(sqlError)})})}):promise=Promise$1.reject("Invalid arguments"),executeCallback(promise,callback),promise}var webSQLStorage={_driver:"webSQLStorage",_initStorage:_initStorage$1,_support:isWebSQLValid(),iterate:iterate$1,getItem:getItem$1,setItem:setItem$1,removeItem:removeItem$1,clear:clear$1,length:length$1,key:key$1,keys:keys$1,dropInstance:dropInstance$1};function isLocalStorageValid(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function _getKeyPrefix(options,defaultConfig){var keyPrefix=options.name+"/";return options.storeName!==defaultConfig.storeName&&(keyPrefix+=options.storeName+"/"),keyPrefix}function checkIfLocalStorageThrows(){var localStorageTestKey="_localforage_support_test";try{return localStorage.setItem(localStorageTestKey,!0),localStorage.removeItem(localStorageTestKey),!1}catch{return!0}}function _isLocalStorageUsable(){return!checkIfLocalStorageThrows()||localStorage.length>0}function _initStorage$2(options){var self2=this,dbInfo={};if(options)for(var i in options)dbInfo[i]=options[i];return dbInfo.keyPrefix=_getKeyPrefix(options,self2._defaultConfig),_isLocalStorageUsable()?(self2._dbInfo=dbInfo,dbInfo.serializer=localforageSerializer,Promise$1.resolve()):Promise$1.reject()}function clear$2(callback){var self2=this,promise=self2.ready().then(function(){for(var keyPrefix=self2._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var key2=localStorage.key(i);key2.indexOf(keyPrefix)===0&&localStorage.removeItem(key2)}});return executeCallback(promise,callback),promise}function getItem$2(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=self2.ready().then(function(){var dbInfo=self2._dbInfo,result=localStorage.getItem(dbInfo.keyPrefix+key2);return result&&(result=dbInfo.serializer.deserialize(result)),result});return executeCallback(promise,callback),promise}function iterate$2(iterator,callback){var self2=this,promise=self2.ready().then(function(){for(var dbInfo=self2._dbInfo,keyPrefix=dbInfo.keyPrefix,keyPrefixLength=keyPrefix.length,length2=localStorage.length,iterationNumber=1,i=0;i<length2;i++){var key2=localStorage.key(i);if(key2.indexOf(keyPrefix)===0){var value=localStorage.getItem(key2);if(value&&(value=dbInfo.serializer.deserialize(value)),value=iterator(value,key2.substring(keyPrefixLength),iterationNumber++),value!==void 0)return value}}});return executeCallback(promise,callback),promise}function key$2(n,callback){var self2=this,promise=self2.ready().then(function(){var dbInfo=self2._dbInfo,result;try{result=localStorage.key(n)}catch{result=null}return result&&(result=result.substring(dbInfo.keyPrefix.length)),result});return executeCallback(promise,callback),promise}function keys$2(callback){var self2=this,promise=self2.ready().then(function(){for(var dbInfo=self2._dbInfo,length2=localStorage.length,keys2=[],i=0;i<length2;i++){var itemKey=localStorage.key(i);itemKey.indexOf(dbInfo.keyPrefix)===0&&keys2.push(itemKey.substring(dbInfo.keyPrefix.length))}return keys2});return executeCallback(promise,callback),promise}function length$2(callback){var self2=this,promise=self2.keys().then(function(keys2){return keys2.length});return executeCallback(promise,callback),promise}function removeItem$2(key2,callback){var self2=this;key2=normalizeKey(key2);var promise=self2.ready().then(function(){var dbInfo=self2._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key2)});return executeCallback(promise,callback),promise}function setItem$2(key2,value,callback){var self2=this;key2=normalizeKey(key2);var promise=self2.ready().then(function(){value===void 0&&(value=null);var originalValue=value;return new Promise$1(function(resolve,reject){var dbInfo=self2._dbInfo;dbInfo.serializer.serialize(value,function(value2,error){if(error)reject(error);else try{localStorage.setItem(dbInfo.keyPrefix+key2,value2),resolve(originalValue)}catch(e){(e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&reject(e),reject(e)}})})});return executeCallback(promise,callback),promise}function dropInstance$2(options,callback){if(callback=getCallback.apply(this,arguments),options=typeof options!="function"&&options||{},!options.name){var currentConfig=this.config();options.name=options.name||currentConfig.name,options.storeName=options.storeName||currentConfig.storeName}var self2=this,promise;return options.name?promise=new Promise$1(function(resolve){options.storeName?resolve(_getKeyPrefix(options,self2._defaultConfig)):resolve(options.name+"/")}).then(function(keyPrefix){for(var i=localStorage.length-1;i>=0;i--){var key2=localStorage.key(i);key2.indexOf(keyPrefix)===0&&localStorage.removeItem(key2)}}):promise=Promise$1.reject("Invalid arguments"),executeCallback(promise,callback),promise}var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:_initStorage$2,_support:isLocalStorageValid(),iterate:iterate$2,getItem:getItem$2,setItem:setItem$2,removeItem:removeItem$2,clear:clear$2,length:length$2,key:key$2,keys:keys$2,dropInstance:dropInstance$2},sameValue=function(x,y){return x===y||typeof x=="number"&&typeof y=="number"&&isNaN(x)&&isNaN(y)},includes=function(array,searchElement){for(var len=array.length,i=0;i<len;){if(sameValue(array[i],searchElement))return!0;i++}return!1},isArray=Array.isArray||function(arg){return Object.prototype.toString.call(arg)==="[object Array]"},DefinedDrivers={},DriverSupport={},DefaultDrivers={INDEXEDDB:asyncStorage,WEBSQL:webSQLStorage,LOCALSTORAGE:localStorageWrapper},DefaultDriverOrder=[DefaultDrivers.INDEXEDDB._driver,DefaultDrivers.WEBSQL._driver,DefaultDrivers.LOCALSTORAGE._driver],OptionalDriverMethods=["dropInstance"],LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(OptionalDriverMethods),DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg)for(var _key in arg)arg.hasOwnProperty(_key)&&(isArray(arg[_key])?arguments[0][_key]=arg[_key].slice():arguments[0][_key]=arg[_key])}return arguments[0]}var LocalForage=function(){function LocalForage2(options){_classCallCheck(this,LocalForage2);for(var driverTypeKey in DefaultDrivers)if(DefaultDrivers.hasOwnProperty(driverTypeKey)){var driver=DefaultDrivers[driverTypeKey],driverName=driver._driver;this[driverTypeKey]=driverName,DefinedDrivers[driverName]||this.defineDriver(driver)}this._defaultConfig=extend({},DefaultConfig),this._config=extend({},this._defaultConfig,options),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return LocalForage2.prototype.config=function(options){if((typeof options>"u"?"undefined":_typeof(options))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in options){if(i==="storeName"&&(options[i]=options[i].replace(/\W/g,"_")),i==="version"&&typeof options[i]!="number")return new Error("Database version must be a number.");this._config[i]=options[i]}return"driver"in options&&options.driver?this.setDriver(this._config.driver):!0}else return typeof options=="string"?this._config[options]:this._config},LocalForage2.prototype.defineDriver=function(driverObject,callback,errorCallback){var promise=new Promise$1(function(resolve,reject){try{var driverName=driverObject._driver,complianceError=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!driverObject._driver){reject(complianceError);return}for(var driverMethods=LibraryMethods.concat("_initStorage"),i=0,len=driverMethods.length;i<len;i++){var driverMethodName=driverMethods[i],isRequired=!includes(OptionalDriverMethods,driverMethodName);if((isRequired||driverObject[driverMethodName])&&typeof driverObject[driverMethodName]!="function"){reject(complianceError);return}}var configureMissingMethods=function(){for(var methodNotImplementedFactory=function(methodName){return function(){var error=new Error("Method "+methodName+" is not implemented by the current driver"),promise2=Promise$1.reject(error);return executeCallback(promise2,arguments[arguments.length-1]),promise2}},_i=0,_len=OptionalDriverMethods.length;_i<_len;_i++){var optionalDriverMethod=OptionalDriverMethods[_i];driverObject[optionalDriverMethod]||(driverObject[optionalDriverMethod]=methodNotImplementedFactory(optionalDriverMethod))}};configureMissingMethods();var setDriverSupport=function(support){DefinedDrivers[driverName]&&console.info("Redefining LocalForage driver: "+driverName),DefinedDrivers[driverName]=driverObject,DriverSupport[driverName]=support,resolve()};"_support"in driverObject?driverObject._support&&typeof driverObject._support=="function"?driverObject._support().then(setDriverSupport,reject):setDriverSupport(!!driverObject._support):setDriverSupport(!0)}catch(e){reject(e)}});return executeTwoCallbacks(promise,callback,errorCallback),promise},LocalForage2.prototype.driver=function(){return this._driver||null},LocalForage2.prototype.getDriver=function(driverName,callback,errorCallback){var getDriverPromise=DefinedDrivers[driverName]?Promise$1.resolve(DefinedDrivers[driverName]):Promise$1.reject(new Error("Driver not found."));return executeTwoCallbacks(getDriverPromise,callback,errorCallback),getDriverPromise},LocalForage2.prototype.getSerializer=function(callback){var serializerPromise=Promise$1.resolve(localforageSerializer);return executeTwoCallbacks(serializerPromise,callback),serializerPromise},LocalForage2.prototype.ready=function(callback){var self2=this,promise=self2._driverSet.then(function(){return self2._ready===null&&(self2._ready=self2._initDriver()),self2._ready});return executeTwoCallbacks(promise,callback,callback),promise},LocalForage2.prototype.setDriver=function(drivers,callback,errorCallback){var self2=this;isArray(drivers)||(drivers=[drivers]);var supportedDrivers=this._getSupportedDrivers(drivers);function setDriverToConfig(){self2._config.driver=self2.driver()}function extendSelfWithDriver(driver){return self2._extend(driver),setDriverToConfig(),self2._ready=self2._initStorage(self2._config),self2._ready}function initDriver(supportedDrivers2){return function(){var currentDriverIndex=0;function driverPromiseLoop(){for(;currentDriverIndex<supportedDrivers2.length;){var driverName=supportedDrivers2[currentDriverIndex];return currentDriverIndex++,self2._dbInfo=null,self2._ready=null,self2.getDriver(driverName).then(extendSelfWithDriver).catch(driverPromiseLoop)}setDriverToConfig();var error=new Error("No available storage method found.");return self2._driverSet=Promise$1.reject(error),self2._driverSet}return driverPromiseLoop()}}var oldDriverSetDone=this._driverSet!==null?this._driverSet.catch(function(){return Promise$1.resolve()}):Promise$1.resolve();return this._driverSet=oldDriverSetDone.then(function(){var driverName=supportedDrivers[0];return self2._dbInfo=null,self2._ready=null,self2.getDriver(driverName).then(function(driver){self2._driver=driver._driver,setDriverToConfig(),self2._wrapLibraryMethodsWithReady(),self2._initDriver=initDriver(supportedDrivers)})}).catch(function(){setDriverToConfig();var error=new Error("No available storage method found.");return self2._driverSet=Promise$1.reject(error),self2._driverSet}),executeTwoCallbacks(this._driverSet,callback,errorCallback),this._driverSet},LocalForage2.prototype.supports=function(driverName){return!!DriverSupport[driverName]},LocalForage2.prototype._extend=function(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)},LocalForage2.prototype._getSupportedDrivers=function(drivers){for(var supportedDrivers=[],i=0,len=drivers.length;i<len;i++){var driverName=drivers[i];this.supports(driverName)&&supportedDrivers.push(driverName)}return supportedDrivers},LocalForage2.prototype._wrapLibraryMethodsWithReady=function(){for(var i=0,len=LibraryMethods.length;i<len;i++)callWhenReady(this,LibraryMethods[i])},LocalForage2.prototype.createInstance=function(options){return new LocalForage2(options)},LocalForage2}(),localforage_js=new LocalForage;module3.exports=localforage_js},{3:3}]},{},[4])(4)})}});var import_localforage=__toESM(require_localforage(),1);var ExtensionId="iebpjdmgckacbodjpijphcplhebcmeop",ExtBase=`chrome-extension://${ExtensionId}`;var StorageWrapper=class{set(key){throw new Error("StorageWrapper -> set not supported")}get(key){throw new Error("StorageWrapper -> get not supported")}remove(key){throw new Error("StorageWrapper -> remove not supported")}getMaxItems(){return chrome.storage.sync.MAX_ITEMS}getItemByteQuota(){return chrome.storage.sync.QUOTA_BYTES_PER_ITEM}};var ChromeStorageWrapper=class extends StorageWrapper{api_;constructor(api){super(),this.api_=api}removeP(key){return new Promise(resolve=>{this.api_.remove(key,resolve)})}setP(values){return new Promise((resolve,reject)=>{this.api_.set(values,response=>{hasRuntimeError()?reject(getRuntimeError()):resolve(response)})})}getP(keyOrObj){return new Promise(resolve=>{this.api_.get(keyOrObj,resolve)})}},ChromeSyncStorageWrapper=class extends ChromeStorageWrapper{constructor(){super(chrome.storage.sync)}},ChromeLocalStorageWrapper=class extends ChromeStorageWrapper{constructor(){super(chrome.storage.local)}};function hasRuntimeError(){return!!chrome.runtime.lastError}function createTab(params){return new Promise(resolve=>{chrome.tabs.create(params,resolve)})}function isPageOnboardingPage(url){return!!url&&url.startsWith("chrome-extension://")&&url.includes("onboard/onboard.html")}function getRuntimeError(){return chrome.runtime.lastError}function checkLogSwallowLastError(message,ignoreIfContains){if(chrome.runtime.lastError){let error=chrome.runtime.lastError.message;if(error&&error.includes(ignoreIfContains))return;console.log(message,chrome.runtime.lastError.message)}}function checkLogLastError(message=""){chrome.runtime.lastError&&console.log(message,chrome.runtime.lastError.message)}function addStorageChangeListener(cb){chrome.storage.onChanged.addListener(cb)}function getSyncStorageApi(){return new ChromeSyncStorageWrapper}function getLocalStorageApi(){return new ChromeLocalStorageWrapper}function initLocalForage(){import_localforage.default.config({version:1,driver:import_localforage.default.INDEXEDDB,storeName:"tc_jsonbk",name:"tablecapture",description:"Backup json for Table Capture"})}initLocalForage();var ActiveTableKey="tc-active-editable-table",ActiveCloudTableKey="tc-active-cloud-table",InstallDateKey="tc-install-date",FrameIdsKey="tc-frame-ids-";async function getActiveCloudTable(){try{let retrievedDataString=await import_localforage.default.getItem(ActiveCloudTableKey);if(retrievedDataString)return JSON.parse(retrievedDataString)}catch{}return null}async function storeActiveCloudTable(repro){if(repro===null)try{await import_localforage.default.removeItem(ActiveCloudTableKey);return}catch(err){throw err}try{let stringifiedData=JSON.stringify(repro);await import_localforage.default.setItem(ActiveCloudTableKey,stringifiedData)}catch(err){throw err}}async function getActiveTable(){try{let retrievedDataString=await import_localforage.default.getItem(ActiveTableKey);if(retrievedDataString)return JSON.parse(retrievedDataString)}catch{}return null}async function storeActiveTable(table){try{let stringifiedData=JSON.stringify(table);await import_localforage.default.setItem(ActiveTableKey,stringifiedData)}catch(err){throw err}}async function getDataForKey(key){try{let retrievedDataString=await import_localforage.default.getItem(key);if(retrievedDataString)return JSON.parse(retrievedDataString)}catch{}return null}async function storeDataForKey(key,thing){try{let stringifiedData=JSON.stringify(thing);await import_localforage.default.setItem(key,stringifiedData)}catch(err){throw err}}async function clearDataForKey(key){try{await import_localforage.default.removeItem(key)}catch(err){return Promise.reject(err)}return Promise.resolve()}async function getStoredFrameIdsForTab(tabId){try{let retrievedDataString=await import_localforage.default.getItem(FrameIdsKey+tabId);if(retrievedDataString){let ids=JSON.parse(retrievedDataString);return Array.from(new Set(ids??[]))}}catch{}return[]}function pagingStateId(tabId){return`paging-state-${tabId}`}async function getPagingStateMap(tabId){try{return await getDataForKey(pagingStateId(tabId))??{}}catch(err){return Promise.reject(err)}}async function storeFrameIdsForTab(tabId,frameIds){try{let stringifiedData=JSON.stringify(frameIds);await import_localforage.default.setItem(FrameIdsKey+tabId,stringifiedData)}catch(err){throw err}}async function storePagingState(tabId,frameId,pagingState){try{let pagingStateMap=await getPagingStateMap(tabId);pagingStateMap[frameId]=pagingState;let stringifiedData=JSON.stringify(pagingStateMap);await import_localforage.default.setItem(pagingStateId(tabId),stringifiedData)}catch(err){throw err}}async function getPagingStateForFrame(tabId,frameId){try{return(await getPagingStateMap(tabId))[frameId]??null}catch{}return null}async function getInstallDate(){try{return await getDataForKey(InstallDateKey)??0}catch(err){return Promise.reject(err)}}async function saveInstallDate(){try{await storeDataForKey(InstallDateKey,Date.now())}catch(err){return Promise.reject(err)}return Promise.resolve()}async function clearTabState(key){return clearDataForKey(key)}async function saveTabState(key,tabState){try{await storeDataForKey(key,tabState)}catch(err){return Promise.reject(err)}return Promise.resolve()}async function getTabState(key){try{return await getDataForKey(key)}catch(err){return Promise.reject(err)}}async function saveTableAndOpenTableEdit(publicTable){try{await storeActiveTable(publicTable)}catch(err){return Promise.reject(err)}return createTab({url:"/table-edit.html"}),Promise.resolve()}async function retrieveActiveEditableTable(){try{return await getActiveTable()}catch(err){return Promise.reject(err)}}async function saveActiveCloudTableAndOpenCloudCTA(req){try{await storeActiveCloudTable(req.repro)}catch(err){return Promise.reject(err)}createTab({url:"/cloud.html"})}async function addFrameIdForTab(tabId,frameId){try{let frameIds=await getStoredFrameIdsForTab(tabId);frameIds.push(frameId),await storeFrameIdsForTab(tabId,frameIds)}catch(err){return Promise.reject(err)}}async function removeFrameIdsForTab(tabId,frameIds){try{let newFrameIds=(await getStoredFrameIdsForTab(tabId)).filter(id=>!frameIds.includes(id));await storeFrameIdsForTab(tabId,newFrameIds)}catch(err){return Promise.reject(err)}}async function getFrameIdsForTab(tabId){if(tabId===void 0)return[];try{return await getStoredFrameIdsForTab(tabId)}catch(err){return Promise.reject(err)}}async function saveFrameIdsForTab(tabId,frameIds){try{await storeFrameIdsForTab(tabId,frameIds)}catch(err){return Promise.reject(err)}}function pagingContinuationKey(url){return`paging-continuation-${url}`}async function clearPagingContinuationState(){try{await import_localforage.default.iterate((_value,key)=>{if(key.startsWith("paging-continuation-"))return import_localforage.default.removeItem(key)})}catch(err){return Promise.reject(err)}}async function hasPagingContinuationForUrl(url){try{return await getDataForKey(pagingContinuationKey(url))}catch(err){return Promise.reject(err)}}async function setPagingContinuationForUrl(url,value){try{await storeDataForKey(pagingContinuationKey(url),value)}catch(err){return Promise.reject(err)}}async function getPagingStatesForAllTabs(){try{let pagingKeys=(await import_localforage.default.keys()).filter(key=>key.startsWith("paging-state-")),pagingStates=[];for(let key of pagingKeys){let pagingStateMap=await getDataForKey(key);pagingStateMap&&pagingStates.push(...Object.values(pagingStateMap))}return pagingStates}catch(err){return Promise.reject(err)}}async function getPagingStatesForTab(tabId){try{let pagingStateMap=await getPagingStateMap(tabId);return Object.values(pagingStateMap)}catch(err){return Promise.reject(err)}}async function getOrCreatePagingStateForTabFrame(tabId,frameId,style,pagingState){if(!pagingState.pathToElement)return Promise.reject("No path to element.");try{let existingState=await getPagingStateForFrame(tabId,frameId);if(existingState)return{...existingState,...pagingState}}catch{}try{let newPagingState={updated:Date.now(),tabId,frameId,style,paging:!1,autoPageTable:!1,treatAsTable:!1,identityColumns:[],dataAttributes:{dataArray:[],rows:0,cols:0},pageCount:0,firstPageSize:-1,pathToElement:pagingState.pathToElement,url:"",...pagingState};return await storePagingState(tabId,frameId,newPagingState),newPagingState}catch(err){return Promise.reject(err)}}async function getPagingStateForTabFrame(tabId,frameId){try{return await getPagingStateForFrame(tabId,frameId)}catch(err){return Promise.reject(err)}}async function updatePagingStateForTabFrame(tabId,frameId,updatedValue){if(frameId!==updatedValue.frameId)return Promise.reject("Frame ID mismatch.");try{await storePagingState(tabId,frameId,{...updatedValue,updated:Date.now()})}catch(err){return Promise.reject(err)}}async function clearPagingState(tabId){return clearDataForKey(pagingStateId(tabId))}function bookmarkId(urlString){let url=new URL(urlString);return`bookmark-url-${url.hostname}${url.pathname}`}async function getPagingStateBookmarkForUrl(url){try{return await getDataForKey(bookmarkId(url))}catch(err){return Promise.reject(err)}}async function bookmarkPagingStateForUrl(url,pagingStateToBookmark){try{let stringifiedData=JSON.stringify(pagingStateToBookmark);await import_localforage.default.setItem(bookmarkId(url),stringifiedData)}catch(err){throw err}}async function getAllUrlBookmarks(){try{let bookmarkKeys=(await import_localforage.default.keys()).filter(key=>key.startsWith("bookmark-url-")),bookmarks=[];for(let key of bookmarkKeys){let bookmark=await getDataForKey(key);bookmark&&bookmarks.push(bookmark)}return bookmarks}catch(err){return Promise.reject(err)}}async function clearAllOldBookmarks(){let yesterday=Date.now()-864e5;try{await import_localforage.default.iterate(async(_value,key)=>{if(key.startsWith("bookmark-url-")){let pagingState=await getDataForKey(key);return pagingState&&(pagingState.updated<yesterday||pagingState.updated===void 0)?import_localforage.default.removeItem(key):Promise.resolve()}})}catch(err){return Promise.reject(err)}}async function storeCollectionName(collection){let collectionNames=await getDataForKey("tc-clip-collections")??[];collectionNames.push(collection),await storeDataForKey("tc-clip-collections",Array.from(new Set(collectionNames)))}async function clearClipCollectionData(){let collectionNames=await getDataForKey("tc-clip-collections");if(collectionNames)for(let collection of collectionNames)await clearDataForKey(collection);await clearDataForKey("tc-clip-collections")}async function getClipCollection(collection){try{let data=await getDataForKey(collection);if(data&&data.length>0){let{collection:collection2,collectionName,sourceUrl}=data[0];return{collection:collection2,collectionName,sourceUrl,data}}return null}catch(err){return Promise.reject(err)}}async function getClipCollectionData(){try{let collectionKeys=await getDataForKey("tc-clip-collections");if(!collectionKeys)return[];let collections=[];for(let collectionKey of collectionKeys){let collection=await getClipCollection(collectionKey);collection!==null&&collections.push(collection)}return collections}catch(err){return Promise.reject(err)}}async function saveClipCollectionData(collectionData){try{await storeCollectionName(collectionData.collection);let existingData=await getDataForKey(collectionData.collection),dataToSave=[];existingData&&(dataToSave=existingData),dataToSave.push(collectionData),await storeDataForKey(collectionData.collection,dataToSave)}catch(err){return Promise.reject(err)}}var GoogleSheetListKey="tc-google-sheets-list";async function getAllSheetData(){try{return await getDataForKey(GoogleSheetListKey)??[]}catch(err){return Promise.reject(err)}}async function clearAllGoogleSheetsData(){return clearDataForKey(GoogleSheetListKey)}async function saveSheetData(sheetDataList){try{await storeDataForKey(GoogleSheetListKey,sheetDataList)}catch(err){return Promise.reject(err)}}async function addOrUpdateGoogleSheetsDataFromScrape(scrapedSheetData){try{let allSheetData=await getAllSheetData(),matchingIndex=allSheetData.findIndex(sheet=>sheet.id===scrapedSheetData.id);if(matchingIndex>-1){let existing=allSheetData[matchingIndex],newSheetData={...scrapedSheetData,instanceId:existing.instanceId,userTitle:existing.userTitle};allSheetData[matchingIndex]=newSheetData}else allSheetData.push(scrapedSheetData);await saveSheetData(allSheetData)}catch(err){return Promise.reject(err)}}async function updateGoogleSheetsData(sheetData){try{let updatedSheetData=(await getAllSheetData()).map(sheet=>sheet.instanceId===sheetData.instanceId?sheetData:sheet);await saveSheetData(updatedSheetData)}catch(err){return Promise.reject(err)}}async function addGoogleSheetsData(sheetData){try{let allSheetData=await getAllSheetData();allSheetData.push(sheetData),await saveSheetData(allSheetData)}catch(err){return Promise.reject(err)}}var TEMP_STORAGE_KEYS={googExport:"tableCaptureTab",o365Export:"tableCaptureO365",install:"tableCaptureInstallTime"};function handleRequestToOpenUrl(request,_sender,sendResponse){let{url,outputFormat,enablePastePrompt}=request;return createTab({selected:!0,url}).then(tab=>{if(!tab.id)return;let tabState={tabId:tab.id,timestamp:Date.now()};enablePastePrompt&&(outputFormat==="GOOG"?saveTabState(TEMP_STORAGE_KEYS.googExport,tabState):outputFormat==="OFFICE365"&&saveTabState(TEMP_STORAGE_KEYS.o365Export,tabState))}),sendResponse({})}function checkShouldPrompt(tabState){return tabState?Date.now()-tabState.timestamp<1e3*5:!1}function sendPromptMessage(tabId,key){let action="PROMPT_PASTE";chrome.tabs.sendMessage(tabId,{action},{},response=>{hasRuntimeError()?checkLogLastError(">> sendPromptMessage: Error caught |>"):response&&"alerted"in response&&response.alerted&&clearTabState(key)})}async function checkUrlBasedActions(tabId,url){if(url.includes("google")){let key=TEMP_STORAGE_KEYS.googExport,tabState=await getTabState(key);checkShouldPrompt(tabState)&&sendPromptMessage(tabId,key)}if(url.includes(".sharepoint.com/")){let key=TEMP_STORAGE_KEYS.o365Export,tabState=await getTabState(key);checkShouldPrompt(tabState)&&sendPromptMessage(tabId,key)}}var UNINSTALL_URL="https://georgemike.com/tablecapture/uninstall/",BASE_API_URL="https://georgemike.com/api",MajorVersion=11,MinorVersion=14,EXT_PLATFORM="C",CurrentVersion=`${MajorVersion}.0.${MinorVersion}${EXT_PLATFORM}`;var DEV_PRETEND_PRO=!1,DEV_PRETEND_CLOUD=!1,DEV_ENTROPY_ENABLED=!1,DEV_DEBUG=!1,DEV_DEBUG_FINE=!1;var CloudConfigKeys=["gptApiKey","gptTokensConsumed"],ExtractConfigKeys=["addNewLinesForParagraphs","csvDelimiter","deleteEmptyRows","extractImageSrc","getLinkUrls","inlineImagesGSheets","ignoreHiddenPageElements","ignoreHiddenTables","ignoreImages","moneyAsNumber","numberAsNumber","numDecimalChar","numThousandChar","redGreenExtract","removeStrikethroughs"],DurationConfigKeys=["autoScrollInterval","sheetSyncWriteInterval","autoPageWait"],AllConfigKeys=[...ExtractConfigKeys,...CloudConfigKeys,...DurationConfigKeys,"alwaysAllowColumnify","copyImagesToClipboard","enableGDriveWrite","enablePastePrompt","enableRequestSearch","enableUrlAutoPage","filenameTemplate","renderRowPreview","showDeveloperOptions","singleSheetExcelExport","useUnifiedPaging","onboarded","installDate","licenseCode","paidPro","paidCloud","cloudLicenseCode","requiresPaid","googleAuthToken","googleAuthRefreshToken","user","recipes"],DurationDefaultValues={autoScrollInterval:.75*1e3,sheetSyncWriteInterval:10*1e3,autoPageWait:3*1e3},CloudConfigDefaults={gptTokensConsumed:0,gptApiKey:null},UserConfigDefaults={...CloudConfigDefaults,...DurationDefaultValues,addNewLinesForParagraphs:!1,alwaysAllowColumnify:!1,copyImagesToClipboard:!1,csvDelimiter:",",deleteEmptyRows:!0,enableGDriveWrite:!1,enablePastePrompt:!0,enableRequestSearch:!1,enableUrlAutoPage:!1,extractImageSrc:!1,filenameTemplate:"",getLinkUrls:!1,ignoreHiddenPageElements:!0,ignoreHiddenTables:!0,ignoreImages:!1,inlineImagesGSheets:!1,moneyAsNumber:!1,numberAsNumber:!1,numDecimalChar:".",numThousandChar:",",redGreenExtract:!1,removeStrikethroughs:!1,renderRowPreview:!0,showDeveloperOptions:!1,singleSheetExcelExport:!1,useUnifiedPaging:!1,onboarded:!1,installDate:null,licenseCode:null,paidPro:!1,paidCloud:!1,paidProOrMore:!1,cloudLicenseCode:null,requiresPaid:!1,user:null,googleAuthToken:null,googleAuthRefreshToken:null,recipes:[]};var CloudLicenseProducts=["tablecapturecloud"];var AdjacentProducts=["edgecapture","foxcapture","tablecapture","tablecapturepro","tablecapturelife","tablecapturecloud","tabletoexcel"];var LicenseUrl=`${BASE_API_URL}/licensing/charge`;function swallowError(err,context){try{DEV_DEBUG&&console.log(`${context} Error Caught: `,err)}catch{}}function backgroundCheckSetLicense({licenseCode,cloudLicenseCode,googleAuthToken},context=""){licenseCode&&checkLicenseAgainstLicensingServer(licenseCode,"pro",context),cloudLicenseCode&&licenseCode&&checkLicenseAgainstLicensingServer(licenseCode,"cloud",context)}function checkLicenseAgainstLicensingServer(code,type,context){let url=`${LicenseUrl}/${code}?activate=0&licensecheck=1&checkcontext=${context}`;fetch(url).then(response=>response.ok?response.json():response.json().then(errResponse=>{throw errResponse})).then(response=>{let now=new Date().getTime(),activeLicenses=(response&&response.licenses?response.licenses:[]).filter(l=>!l.cancelled).filter(l=>Number(l.expiration)>now),newVals={};if(type==="pro"){let activeProLicenses=activeLicenses.filter(l=>AdjacentProducts.includes(l.product));newVals.paidPro=activeProLicenses.length>0,newVals.paidProOrMore=newVals.paidPro,newVals.licenseCode=code}else if(type==="cloud"){let activeCloudLicenses=activeLicenses.filter(l=>CloudLicenseProducts.includes(l.product));newVals.paidCloud=activeCloudLicenses.length>0,newVals.paidCloud&&(newVals.paidPro=!0,newVals.paidProOrMore=!0)}return getSyncStorageApi().setP(newVals)}).catch(err=>swallowError(err,"backgroundCheckSetLicense"))}function getYYYYMMDD(date){let leftPaddedMonth=(date.getMonth()+1).toString().padStart(2,"0"),leftPaddedDate=date.getDate().toString().padStart(2,"0");return`${date.getFullYear()}${leftPaddedMonth}${leftPaddedDate}`}var BigSyncStorage=class{storageApi_;maxItems_;constructor(storageApi){this.storageApi_=storageApi,this.maxItems_=this.storageApi_.getMaxItems()}getWorlds(defaultVals,worldKeys){return defaultVals=defaultVals||{},worldKeys=worldKeys||[],worldKeys.forEach(worldKey=>defaultVals[worldKey]=""),this.storageApi_.getP(null).then(items=>{if(hasRuntimeError())throw getRuntimeError();let vals={...defaultVals,...items},worlds=[];return worldKeys.forEach(worldKey=>{let world="";for(var i=0;i<this.maxItems_;i++){let key=`${worldKey}_${i}`;if(items[key])world+=items[key];else break}world&&worlds.push(JSON.parse(world))}),worlds.forEach(worldObj=>{vals={...vals,...worldObj}}),{...defaultVals,...vals}})}deleteWorld(worldKey){return this.getWorlds({},[worldKey]).then(vals=>Promise.all(Object.keys(vals).filter(key=>key.includes(worldKey)).map(key=>this.storageApi_.removeP(key))))}setWorld(worldKey,vals){let i=0,cache={},stringVal=JSON.stringify(vals);for(;stringVal.length>0;){let cacheKey=`${worldKey}_${i}`,segment=null,endIndex=this.storageApi_.getItemByteQuota()-cacheKey.length-2;for(;;){if(endIndex<500)return Promise.reject(new Error("BigSyncStorage: World segmentation error (< 500/key)"));segment=stringVal.substr(0,endIndex);let keyLength=16,jsonStringifiedSegment=JSON.stringify(segment);if(lengthInUtf8Bytes(jsonStringifiedSegment)>this.storageApi_.getItemByteQuota()-2-keyLength)endIndex-=500;else break}cache[cacheKey]=segment,stringVal=stringVal.substr(endIndex),i++}return this.storageApi_.setP(cache).then(()=>this.storageApi_.removeP(`${worldKey}_${i}`))}};function lengthInUtf8Bytes(str){var m=encodeURIComponent(str).match(/%[89ABab]/g);return str.length+(m?m.length:0)}function getWorlds(worldKeys,defaultVals){return new BigSyncStorage(getSyncStorageApi()).getWorlds(defaultVals,worldKeys)}function setWorld(worldKey,values){return new BigSyncStorage(getSyncStorageApi()).setWorld(worldKey,values)}function openNewOptionsPage(param=""){let url=chrome.runtime.getURL(`options.html?${param??""}`);chrome.tabs.create({url})}function getCurrentExtensionPageUrl(){return typeof window<"u"&&"location"in window&&window.location&&window.location.href?window.location.href:null}function getExtensionUserConfig(ignorePageUrl=!1){return getWorlds(["_recipe_world"],UserConfigDefaults).then(values=>{Object.keys(values).forEach(key=>{AllConfigKeys.includes(key)||delete values[key]});let config={...values};if(DEV_PRETEND_PRO&&(config.paidPro=!0),DEV_PRETEND_CLOUD&&(config.paidCloud=!0),config.paidProOrMore=!!config.paidPro||!!config.paidCloud,!ignorePageUrl&&!config.paidProOrMore){let pageUrl=getCurrentExtensionPageUrl();pageUrl!==null&&(config.paidPro=isPageOnboardingPage(pageUrl))}return config})}var LICENSE_CHECK_NUM=50,USER_CONFIG=null,USER_CONFIG_CACHE_HIT_COUNT=0;async function maybeBackgroundUpdateUserConfig(userConfig){let newVals={};if(!userConfig.installDate){let installDate=await getInstallDate();installDate&&(newVals.installDate=getYYYYMMDD(new Date(installDate)))}if(Object.keys(newVals).length>0)return getSyncStorageApi().setP(newVals)}function updateLocalUserConfig(){return getExtensionUserConfig().then(userConfig=>(USER_CONFIG=userConfig,USER_CONFIG_CACHE_HIT_COUNT=0,maybeBackgroundUpdateUserConfig(USER_CONFIG),USER_CONFIG)).catch(err=>swallowError(err,"updateLocalUserConfig-getExtensionUserConfig"))}function initCachedExtensionUserConfig(){addStorageChangeListener(updateLocalUserConfig),updateLocalUserConfig()}function syncGetCachedExtensionUserConfig(){return USER_CONFIG}function getCachedExtensionUserConfig(context=""){return USER_CONFIG?(USER_CONFIG_CACHE_HIT_COUNT++,USER_CONFIG.paidPro&&USER_CONFIG_CACHE_HIT_COUNT>LICENSE_CHECK_NUM&&(USER_CONFIG_CACHE_HIT_COUNT=0,backgroundCheckSetLicense(USER_CONFIG,context)),Promise.resolve(USER_CONFIG)):updateLocalUserConfig().then(userConfig=>userConfig??null)}function isUrlExtensionPopup(tabUrl){return tabUrl?tabUrl.startsWith("chrome-extension://")&&tabUrl.includes("popup.html"):!1}var TableActionLogger=class{userConfig_;extractConfig_;localStorageApi_;constructor(userConfig){this.userConfig_=userConfig,this.extractConfig_={...userConfig},this.localStorageApi_=getLocalStorageApi()}initLogDataForUrl_(logData,url,title){logData.version||(logData.version="5.2"),logData[url]||(logData[url]={url,title,actionCount:0,elements:{}})}logGptTokensUsed(tokenCounts){return this.localStorageApi_.getP("gptTokensConsumed").then(values=>{let sum=values.gptTokensConsumed||0;return tokenCounts.forEach(count=>sum+=count),this.localStorageApi_.setP({gptTokensConsumed:sum})})}logPublishableTableAction(publishableTable,tcAction){if(publishableTable.paged)return this.logPagedTableAction_(publishableTable,tcAction);if(publishableTable.dynamic)return this.logDynamicTableAction_(publishableTable,tcAction);let{sourceUrl:url,pageTitle,tableDef,treatAsTable}=publishableTable;return url?this.getLogDataForPage_(url,pageTitle).then(logData=>{let{pathTo}=tableDef,key=`dom://${pathTo}`,name=this.getTableName_(pageTitle,tableDef);return logData[url].elements[key]||(logData[url].elements[key]={key,name,paged:!1,dynamic:!1,actionCount:0,repros:[]}),logData[url].actionCount++,logData[url].elements[key].actionCount++,logData[url].elements[key].repros.push({...tcAction,url,pathTo,treatAsTable,extractConfig:this.extractConfig_,timestamp:Date.now()}),this.localStorageApi_.setP({[LogKey]:logData})}).catch(err=>this.handleError_(err)):Promise.reject("No URL present.")}logPagedTableAction_(publishableTable,tcAction){let{sourceUrl:url,pageTitle}=publishableTable;return url?this.getLogDataForPage_(url,pageTitle).then(logData=>{let pagingDef=publishableTable.pagingDef,key=`dom://${pagingDef.pathToElement}`;return logData[url].elements[key]||(logData[url].elements[key]={key,name:`Multi-page Table (Pages: ${publishableTable.pages})`,paged:!0,dynamic:!1,actionCount:0,repros:[]}),logData[url].actionCount++,logData[url].elements[key].actionCount++,logData[url].elements[key].repros.push({...tcAction,url,pagingDef,paged:!0,pages:publishableTable.pages,extractConfig:this.extractConfig_,timestamp:Date.now()}),this.localStorageApi_.setP({[LogKey]:logData})}).catch(err=>this.handleError_(err)):Promise.reject("No URL present.")}logDynamicTableAction_(publishableTable,tcAction){let{sourceUrl:url,pageTitle}=publishableTable;return url?this.getLogDataForPage_(url,pageTitle).then(logData=>this.localStorageApi_.setP({[LogKey]:logData})).catch(err=>this.handleError_(err)):Promise.reject("No URL present.")}logWrapperAction(tableWrapper,tcAction){let{url,pageTitle,def}=tableWrapper.getDirect();return this.logActionForTableWrapperDefs_(tcAction,url,pageTitle,[def],tableWrapper.getReproOptions())}logWrapperDefAction(tableWrapperDefs,tcAction,url,pageTitle){return this.logActionForTableWrapperDefs_(tcAction,url,pageTitle,tableWrapperDefs,null)}logActionForTableWrapperDefs_(tcAction,url,title,defs,reproOptions){if(!url)return Promise.reject("No URL present.");let tcTableDefs=defs.map(def=>{let{index,table,pathTo}=def;if(table){let{id,adjusted:name}=table;return{id,index,pathTo,name}}else if(pathTo){let{id,name}=def;return{id,index,pathTo,name}}throw new Error("TableActionLogger::error - fallthrough")});return this.logActionForTCTableDefs_(tcAction,url,title,tcTableDefs,reproOptions)}logActionForTCTableDefs_(tcAction,url,title,tcTableDefs,reproOptions){return this.getLogDataForPage_(url,title).then(logData=>(tcTableDefs.forEach(tcTableDef=>{let{id,name,index,pathTo}=tcTableDef,key=`dom://${pathTo}`;(!logData[url].elements[key]||name&&logData[url].elements[key].name!=name||logData[url].elements[key].id!=id)&&(logData[url].elements[key]={key,actionCount:0,repros:[],id,pathTo,index,name,paged:!1,dynamic:!1}),logData[url].actionCount++,logData[url].elements[key].actionCount++,logData[url].elements[key].repros.push({...tcAction,...reproOptions,url,pathTo,index,extractConfig:this.extractConfig_,timestamp:Date.now()})}),this.localStorageApi_.setP({[LogKey]:logData}))).catch(err=>this.handleError_(err))}getTableName_(pageTitle,tableDef){if(tableDef){if(tableDef.adjusted)return tableDef.adjusted;if(tableDef.id)return`Table (#${tableDef.id})`;if(tableDef.rows)return`Table (rows: ${tableDef.rows})`}return pageTitle?`Table (${pageTitle})`:"Table (N/A)"}getLogDataForUrlAndDef(url,tableDef){return!tableDef||!url?Promise.resolve(null):this.getLogDataForUrl(url).then(logData=>{let{pathTo}=tableDef,key=`dom://${pathTo}`;if(logData.elements)return logData.elements[key]})}getLogDataForUrl(url){return this.localStorageApi_.getP(LogKey).then(values=>(values[LogKey]||{})[url])}getLogDataForPage_(url,title){return this.localStorageApi_.getP(LogKey).then(values=>{let logData=values[LogKey]||{};return this.initLogDataForUrl_(logData,url,title),logData})}handleError_(err){console.error(err)}};var LogKey="tcapLog";function _tcLogRequestAction(request,userConfig){if(!request.logInfo||!request.logInfo.tableWrapperDefs)return;if(userConfig===null)return swallowError(new Error("UserConfig is unexpectedly null"),"_tcLogRequestAction");let{url,action:messageAction,outputFormat,pageTitle,tableWrapperDefs}=request.logInfo,action={messageAction,outputFormat};new TableActionLogger(userConfig).logWrapperDefAction(tableWrapperDefs,action,url,pageTitle)}function getExtensionActivityLogData(){let key=LogKey;return getLocalStorageApi().getP(key).then(values=>values&&values[key]?formatActivityLogData(values[key]):null)}function formatActivityLogData(logData){let newLogData={...logData};return Object.values(newLogData).filter(entry=>entry&&typeof entry=="object").forEach(logItem=>{Object.values(logItem.elements).forEach(element=>{element.name||(element.id?element.name=`Table#${element.id}`:element.pathTo?element.name=`Table (${element.pathTo})`:element.name="Table")})}),logData}function getReadableOutputFormat(outputFormat){return outputFormat==="CLIPBOARD_DOCUMENT"?"DOCUMENT":outputFormat}function getReadableMessageAction(messageAction){return messageAction?messageAction=="COPY_TABLE_STRING"||messageAction=="COPY_STRING"?"COPY":messageAction=="COPY_TABLE_IMAGE"||messageAction.includes("SCREENSHOT")?"SCREENSHOT":messageAction.includes("EXCEL")?"EXCEL":messageAction.includes("CSV")?"CSV":messageAction==="AI_COLUMN_EXTRACTION"?"MAGIC COLUMNS":messageAction:null}function summarizeRepro({messageAction,outputFormat}){let messageActionStr=messageAction?.toString(),outputFormatStr=outputFormat?.toString(),readableMessageAction=getReadableMessageAction(messageAction);if(messageAction&&messageActionStr===outputFormatStr)return`EXPORT \u2192 ${readableMessageAction}`;if(messageAction&&outputFormat){let readableOutputFormat=getReadableOutputFormat(outputFormat);return`${readableMessageAction} \u2192 ${readableOutputFormat}`}return messageAction?readableMessageAction:"EXPORT"}function safeCreateMenu(createProperties){let id=chrome.contextMenus.create({...createProperties},()=>{hasRuntimeError()});return hasRuntimeError(),id}function getMatchString(urlExample){let url=new URL(urlExample);return`${url.protocol}//${url.hostname}/*`}function createOnLoadScript(onLoadFn){return`
    /** GEORGE STILL LOVES YOU **/
    function handleUserScriptError(message) {
      alert("Table Capture Recipe Error: " + message);
    }

    window.addEventListener("load", async () => {
      try {
        ${onLoadFn}
      } catch (err) {
        debugger;
        handleUserScriptError(err.message);
      }
    });
  `}async function unregisterRecipeWithID(id){if(id)return chrome.userScripts.unregister({ids:[id]});throw new Error("A recipe ID is required to unregister a user script.")}async function registerUserScriptForRecipe(recipe){if(!recipe.id)throw new Error("A recipe ID is required to register a user script.");if(!recipe.urlExample)throw new Error("A recipe URL example is required to register a user script.");if(recipe.disabled){try{await unregisterRecipeWithID(recipe.id)}catch{}return Promise.resolve()}let code=`
    /** GEORGE LOVES YOU **/

    /* This just prints to the console */
    function handleUserScriptWarning(message) {
      console.log("Table Capture: Warning: " + message);
    }

    /* This shows a window.alert deliberately */
    function handleUserScriptError(message) {
      alert("Table Capture Recipe Error: " + message);
    }

    /* This shows a window.alert deliberately */
    function handleMutationError(err, message, errorType) {
      alert("Table Capture (Dynamic) Recipe Error: " + message);
    }
    
    async function getUserConfig() {
      const action = "USER_SCRIPT_GET_USER_CONFIG";
      return new Promise((resolve, reject) => {
        chrome.runtime.sendMessage({ action }, (response) => {
          if (chrome.runtime.lastError) {
            reject(chrome.runtime.lastError.message);
          } else {
            resolve(response.userConfig);
          }
        });
      });
    }

    function doTableExtract(element, userConfig, basePath) {
      try {
        ${recipe.fn}
      } catch (err) {
        debugger;
        handleUserScriptError(err.message);
      }
    }

    function doTableRowElementExtract(element, userConfig) {
      try {
        ${recipe.rpfn}
      } catch (err) {
        debugger;
        handleUserScriptError(err.message);
      }
    }

    async function listenForElementChanges(element, userConfig, recipe) {
      const isTableRecipe = ["TABLE", "TBODY", "THEAD"].includes(element.tagName);
      let rootValueProvider = null;
      let rowValueProvider = null;
      try {
        const fn = doTableExtract;
        const rpfn = doTableRowElementExtract;
        rowValueProvider = (element) => rpfn(element, userConfig);
        rootValueProvider = (element) => fn(element, userConfig);
      } catch (err) {
        throw err;
      }

      let mutationObserverWrapper = null;
      if (isTableRecipe) {
        mutationObserverWrapper = new TableMutationObserverWrapper(rootValueProvider, rowValueProvider);
      } else {
        mutationObserverWrapper = new ArbMutationObserverWrapper(rootValueProvider, rowValueProvider);
      }

      /* We have the user-provided selector, so we can use it */
      mutationObserverWrapper.initializeForElement(element, recipe.selector);

      mutationObserverWrapper.bindToError(handleMutationError);
      mutationObserverWrapper.bindToChange(() => {
        const dataArray = mutationObserverWrapper.getValues() || [];
        const action = "USER_SCRIPT_SEND_DATA";
        const recording = true;
        const params = {
          requestId: Math.random().toString(36).substring(2),
          action,
          data: dataArray,
          recipe,
          userConfig,
          recipeId,
          recording,
        };
        console.log("Table Capture: Sending data from mutation observer:", params.requestId);
        chrome.runtime.sendMessage(params, (response) => {
          if (chrome.runtime.lastError) {
            handleUserScriptError(chrome.runtime.lastError.message);
          }
        });
      });
      mutationObserverWrapper.startRecording();
    }

    async function runRecipe(clip) {
      console.log("Table Capture: Running recipe: ${recipe.name||recipe.id}");

      const recipe = ${JSON.stringify(recipe)};
      const recipeId = "${recipe.id}";
      const sourceUrl = window.location.href;

      /* Make sure the URL matches the recipe's regex */
      if (!sourceUrl.match(new RegExp("${recipe.urlRegex}"))) {
        return handleUserScriptWarning("URL does not match recipe's URL regex.");
      }

      try {
        const element = document.querySelector("${recipe.selector}");
        if (!element) {
          return handleUserScriptWarning("Element not found via selector: ${recipe.selector}");
        }

        const userConfig = await getUserConfig();
        if (recipe.rpfn && !recipe.rpfn.trim().endsWith("return [];")) {
          listenForElementChanges(element, userConfig, recipe);
        }

        const data = doTableExtract(element, userConfig, window.location.origin);
        const action = "USER_SCRIPT_SEND_DATA";
        
        const params = {
          requestId: Math.random().toString(36).substring(2),
          action,
          data,
          recipe,
          userConfig,
          recipeId,
          clip,
          sourceUrl,
        };
        console.log("Table Capture: Extracted data:", params.requestId, data);

        chrome.runtime.sendMessage(params, (response) => {
          if (chrome.runtime.lastError) {
            handleUserScriptError(chrome.runtime.lastError.message);
          }
        });
      } catch (err) {
        debugger;
        handleUserScriptError(err.message);
      }
    }

    /* Run the recipe initially and when invoked by the user from the context menu */
    window.setTimeout(() => runRecipe(true), 1000);
    chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message && message.action) {
        const a = message.action;
        console.log("Table Capture: User Script Received Message: Action =", a);

        if (a === "SELECTION_WORKSHOP_RECIPE") {
          runRecipe(false);
        } else if (a === "SELECTION_WORKSHOP_RECIPE_CLIP") {
          runRecipe(true);
        } else {}
      }

      sendResponse({});
      return true;
    });
  `;chrome.userScripts.configureWorld({messaging:!0});let matchString=getMatchString(recipe.urlExample),existing=(await chrome.userScripts.getScripts()).find(s=>s.id===recipe.id),js=[{code}];recipe.onLoadFn&&(js.push({file:"src/app/bundle-mutationobserverwrapper.js"}),js.push({code:createOnLoadScript(recipe.onLoadFn)})),existing?chrome.userScripts.update([{id:recipe.id,matches:[matchString],js}]):chrome.userScripts.register([{id:recipe.id,matches:[matchString],js}])}function isDomainMatch(host,url){if(!url||!host)return!1;try{return new URL(url).host===host}catch{}return!1}async function getLatestReprosForUrl(url){return getExtensionActivityLogData().then(logData=>{if(!logData)return[];let repros=[];return Object.values(logData).filter(entry=>!!entry&&entry.elements).forEach(entry=>{let exactUrlMatch=entry.url===url;Object.values(entry.elements).filter(pageElementEntry=>pageElementEntry.starred&&pageElementEntry.repros&&pageElementEntry.repros.length).forEach(pageElementEntry=>{let domainMatch=isDomainMatch(pageElementEntry.domain,url);if(exactUrlMatch||pageElementEntry.domainWide&&domainMatch){let latestRepro=pageElementEntry.repros[pageElementEntry.repros.length-1];return repros.push({pageEntry:pageElementEntry,repro:latestRepro})}})}),repros})}async function sendDisplayInlineRequest(tabId,userConfig){let params={action:"DISPLAY_INLINE",tabId,userConfig};chrome.tabs.sendMessage(tabId,params,{},_resp=>{checkLogLastError(">> sendDisplayInlineRequest: Error caught |>")})}function buildMenuItemId(repro){return`repro.${repro.timestamp}`}function isReproMenuItemId(menuItemId){return menuItemId.startsWith("repro.")}async function sendReproRequestForReproId(tabId,tabUrl,userConfig,reproMenuItemId){let reproPair=(await getLatestReprosForUrl(tabUrl)).find(r=>buildMenuItemId(r.repro)===reproMenuItemId);reproPair&&sendReproRequest(tabId,userConfig,reproPair.repro)}function sendReproRequest(tabId,userConfig,repro){let params={action:"REPRO_PERFORM",userConfig,repro};chrome.tabs.sendMessage(tabId,params,{},_resp=>{checkLogLastError(">> sendReproRequest: Error caught |>")})}async function sendSelectionWorkshopRequest(tabId,userConfig,hasSelection){let params={action:"SELECTION_WORKSHOP",userConfig,hasSelection,forTable:!1};return new Promise((resolve,reject)=>{chrome.tabs.sendMessage(tabId,params,{},()=>hasRuntimeError()?(checkLogLastError(">> sendSelectionWorkshopRequest: Error caught |>"),reject(getRuntimeError())):resolve(null))})}function sendWorkshopRecipeClipRequest(tabId,userConfig,recipe){let params={action:"SELECTION_WORKSHOP_RECIPE_CLIP",userConfig,recipe,tabId};chrome.tabs.sendMessage(tabId,params,{},()=>{checkLogLastError(">> background.sendWorkshopRecipeClipRequest: Error caught |>")})}function sendWorkshopRecipeRequest(tabId,userConfig,recipe,onLoad){let params={userConfig,recipe,tabId,onLoad,action:"SELECTION_WORKSHOP_RECIPE"};chrome.tabs.sendMessage(tabId,params,{},()=>{checkLogLastError(">> background.sendWorkshopRecipeRequest: Error caught |>")})}function queryTab(tabId){return new Promise((resolve,reject)=>{chrome.tabs.get(tabId,tab=>{hasRuntimeError()?reject(getRuntimeError()):resolve(tab)})})}function queryActiveTab(context=""){return new Promise((resolve,reject)=>{chrome.tabs.query({active:!0,currentWindow:!0},tabs=>{hasRuntimeError()?reject(getRuntimeError()):!tabs||tabs.length!=1?reject(new Error(`Tab not found: ${context}`)):resolve(tabs[0])})})}function queryTabOrActiveTab(tabId){return tabId?queryTab(tabId):queryActiveTab()}function queryTabForFrameIds(tabId){return new Promise((resolve,reject)=>{chrome.webNavigation.getAllFrames({tabId},frames=>{hasRuntimeError()?reject(getRuntimeError()):resolve(frames?frames.map(f=>f.frameId):[])})})}var recipeContextMenuMap={},activityContextMenuMap={},installMenuItem=null,functionalContextMenus=[];function isActiveTabPdfPage(){return!1}function isActiveTabXmlPage(){return!1}async function isSelectedTabReadyForMessages(tabId){return(await getFrameIdsForTab(tabId)).length>0}function getContextMenuClickDependencies(context,tab){return getCachedExtensionUserConfig(context).then(userConfig=>{if(!userConfig)throw new Error("No user config found.");if(!tab.id||!tab.url)throw new Error("No tab  found.");return{userConfig,tabId:tab.id,tabUrl:tab.url}}).catch(err=>{throw swallowError(err,context),err})}function updateStarredActionContextMenus(url){getLatestReprosForUrl(url).then(reproPairs=>{removeAllStarredActionContextMenus(),reproPairs.forEach(({repro,pageEntry})=>{let summary=summarizeRepro(repro);if(!summary)return;let id=buildMenuItemId(repro);activityContextMenuMap[id]=safeCreateMenu({id,title:chrome.i18n.getMessage("contextMenuActivity",[summary,pageEntry.name||""]),contexts:["page"]})})}).catch(err=>swallowError(err,"updateStarredActionContextMenus"))}function removeAllStarredActionContextMenus(){Object.values(activityContextMenuMap).forEach(menuId=>{chrome.contextMenus.remove(menuId,()=>{checkLogLastError(">> removeAllStarredActionContextMenus: Error caught |>")})}),activityContextMenuMap={}}function getAllRecipes(){return getWorlds(["_recipe_world"],{recipes:[]}).then(({recipes})=>recipes)}function saveUpdatedRecipe(recipe){return getAllRecipes().then(recipes=>{let index=recipes.findIndex(r=>r.id===recipe.id);return recipes[index]=recipe,setWorld("_recipe_world",{recipes})}).catch(err=>swallowError(err,"saveUpdatedRecipe"))}function displayClippingContextMenuAction(recipe){let id=`recipe-${recipe.id}-startclip`;recipeContextMenuMap[id]=safeCreateMenu({id,title:chrome.i18n.getMessage("contextMenuRecipeClipStart",[recipe.name||"N/A"]),contexts:["page"]})}function displayStopClippingContextMenuAction(recipe){let id=`recipe-${recipe.id}-stopclip`;recipeContextMenuMap[id]=safeCreateMenu({id,title:chrome.i18n.getMessage("contextMenuRecipeClipStop",[recipe.name||"N/A"]),contexts:["page"]})}function clearRecipeContextMenus(recipe){if(!recipe.id)return;[`recipe-${recipe.id}-launch`,`recipe-${recipe.id}-stopclip`,`recipe-${recipe.id}-startclip`].forEach(contextMenuId=>{recipeContextMenuMap[contextMenuId]&&chrome.contextMenus.remove(recipeContextMenuMap[contextMenuId],()=>{checkLogLastError(">> clearRecipeContextMenus: Error caught |>")})})}function updateRecipeContextMenus(userConfig,tabUrl){userConfig.recipes.filter(r=>r.status==="active"&&!r.disabled).forEach(recipe=>{if(clearRecipeContextMenus(recipe),recipe.id&&recipe.urlRegex&&tabUrl.match(new RegExp(recipe.urlRegex))){let id=`recipe-${recipe.id}-launch`;registerUserScriptForRecipe(recipe),recipeContextMenuMap[id]=safeCreateMenu({id,title:chrome.i18n.getMessage("contextMenuRecipe",[recipe.name||"N/A"]),contexts:["page"]}),recipe.autoClip?displayStopClippingContextMenuAction(recipe):displayClippingContextMenuAction(recipe)}})}function checkMatchingRecipesAndStarred(tabUrl,userConfig){userConfig.recipes&&userConfig.paidPro&&updateRecipeContextMenus(userConfig,tabUrl),updateStarredActionContextMenus(tabUrl)}function removeInstallMenuPrompt(){installMenuItem&&(chrome.contextMenus.remove(installMenuItem,()=>{checkLogLastError(">> removeInstallMenuPrompt: Error caught |>")}),installMenuItem=null)}function displayInstallMenuPrompt(){installMenuItem||(installMenuItem=safeCreateMenu({id:"install-menu-prompt",title:chrome.i18n.getMessage("contextMenuRefreshNeeded"),contexts:["page","selection"]}))}function removeFunctionalContextMenuItems(){functionalContextMenus.length>0&&functionalContextMenus.forEach(menuId=>{chrome.contextMenus.remove(menuId,()=>{checkLogSwallowLastError(">> removeFunctionalContextMenuItems: Error caught |>","Cannot find menu item with id")})}),functionalContextMenus=[]}function displayFunctionalContextMenuItems(){functionalContextMenus.length!==4&&(functionalContextMenus.push(safeCreateMenu({id:"cmenu-launchworkshop",title:chrome.i18n.getMessage("contextMenuLaunchWorkshop"),contexts:["page"]})),functionalContextMenus.push(safeCreateMenu({id:"cmenu-launchworkshop-element",title:chrome.i18n.getMessage("contextMenuLaunchWorkshopForSelection"),contexts:["selection"]})),functionalContextMenus.push(safeCreateMenu({id:"cmenu-launchworkshop-element-click",title:chrome.i18n.getMessage("contextMenuLaunchWorkshopForElement"),contexts:["link"]})),functionalContextMenus.push(safeCreateMenu({id:"cmenu-inline",title:chrome.i18n.getMessage("contextMenuDisplayInline"),contexts:["page"]})))}function updateContextMenusForPdf(){removeInstallMenuPrompt(),removeFunctionalContextMenuItems(),removeAllStarredActionContextMenus()}function updateContextMenusForXml(){removeInstallMenuPrompt(),removeFunctionalContextMenuItems(),removeAllStarredActionContextMenus()}async function resetContextMenuItems(tabId,tabUrl,userConfig){if(tabId===-1)return;if(isActiveTabPdfPage()){updateContextMenusForPdf();return}if(isActiveTabXmlPage()){updateContextMenusForXml();return}await isSelectedTabReadyForMessages(tabId)?(removeInstallMenuPrompt(),displayFunctionalContextMenuItems(),checkMatchingRecipesAndStarred(tabUrl,userConfig)):displayInstallMenuPrompt()}function updateContextMenus(tabId=void 0){getExtensionUserConfig().then(userConfig=>{queryTabOrActiveTab(tabId).then(tab=>{!tab.id||!tab.url||!userConfig||isUrlExtensionPopup(tab.url)||resetContextMenuItems(tab.id,tab.url,userConfig)})})}function initContextMenus(){updateContextMenus(),chrome.contextMenus.onClicked.addListener((info,tab)=>{if(!tab||isUrlExtensionPopup(tab.url))return;let menuItemId=info.menuItemId;getContextMenuClickDependencies(`ContextMenuItem: ${menuItemId}`,tab).then(({userConfig,tabId,tabUrl})=>handleContextMenuClick(userConfig,tabId,tabUrl,menuItemId))})}function handleContextMenuClick(userConfig,tabId,tabUrl,menuItemId){if(menuItemId!=="install-menu-prompt"){if(menuItemId==="cmenu-inline")sendDisplayInlineRequest(tabId,userConfig);else if(menuItemId==="cmenu-launchworkshop"||menuItemId==="cmenu-launchworkshop-element-click")sendSelectionWorkshopRequest(tabId,userConfig,!1);else if(menuItemId==="cmenu-launchworkshop-element")sendSelectionWorkshopRequest(tabId,userConfig,!0);else if(typeof menuItemId=="string"&&isReproMenuItemId(menuItemId))sendReproRequestForReproId(tabId,tabUrl,userConfig,menuItemId);else if(typeof menuItemId=="string"&&menuItemId.startsWith("recipe-")){let recipeId=menuItemId.split("-")[1],recipe=userConfig.recipes.find(r=>r.id===recipeId);if(!recipe)return;menuItemId.endsWith("launch")?sendWorkshopRecipeRequest(tabId,userConfig,recipe,!1):menuItemId.endsWith("startclip")?(recipe.autoClip=!0,saveUpdatedRecipe(recipe),updateRecipeContextMenus(userConfig,tabUrl),sendWorkshopRecipeClipRequest(tabId,userConfig,recipe)):menuItemId.endsWith("stopclip")&&(recipe.autoClip=!1,saveUpdatedRecipe(recipe),updateRecipeContextMenus(userConfig,tabUrl),createTab({url:"/recipes.html"}))}}}async function trackTabFrame(tabId,frameId){if(!(tabId===void 0||frameId===void 0))try{addFrameIdForTab(tabId,frameId)}catch(err){swallowError(err,"trackTabFrame")}}function sendRuntimeMessage(params){return new Promise((resolve,reject)=>{chrome.runtime.sendMessage(params,response=>hasRuntimeError()?reject(getRuntimeError()):response&&response.err?typeof response.err=="string"?reject(new Error(response.err)):reject(response.err):resolve(response))})}async function sendGetGoogleAuthTokenRequest(){return sendRuntimeMessage({action:"GET_GOOGLE_AUTH_TOKEN"}).then(response=>response&&"token"in response&&response.token||null)}async function getGoogleAuthToken(){return chrome.identity?new Promise((resolve,reject)=>{chrome.identity.getAuthToken({interactive:!0},token=>{if(hasRuntimeError())return reject(getRuntimeError());if(token)return resolve(token);reject(new Error("Unable to retrieve auth token."))})}):sendGetGoogleAuthTokenRequest()}var EntropyLevel=.3;function maybeAddEntropy(){if(DEV_ENTROPY_ENABLED&&Math.random()>EntropyLevel)throw new Error("GMO: Entropic error")}var DefaultSheetName="Sheet1";async function overwriteGoogleSheet(token,sheetId,sheetName,values){let range=`${sheetName}`,clearRange=`${sheetName}!A1:ZZ`;await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${clearRange}:clear`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`}});let valueInputOption="USER_ENTERED",dataValueRange={range,values,majorDimension:"ROWS"};return fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?valueInputOption=${valueInputOption}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`},body:JSON.stringify(dataValueRange)})}async function appendToGoogleSheet(token,sheetId,sheetName,values){let range=sheetName,valueInputOption="USER_ENTERED",dataValueRange={range,values,majorDimension:"ROWS"};return fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}:append?valueInputOption=${valueInputOption}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`},body:JSON.stringify(dataValueRange)})}async function addSheetToGoogleSheet(token,sheetId,sheetName){let data={requests:[{addSheet:{properties:{title:sheetName}}}]};return fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}:batchUpdate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`},body:JSON.stringify(data)})}async function ensureSheetExists(token,sheetId,sheetName){return fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}`,{headers:{Authorization:`Bearer ${token}`}}).then(response=>response.json()).then(document2=>{let googleSheetDocument=document2;if(!googleSheetDocument)throw new Error("Google Sheet not found");if(!googleSheetDocument.sheets.find(sheet2=>sheet2.properties.title===sheetName))return addSheetToGoogleSheet(token,sheetId,sheetName)})}async function writeToGoogleSheetInGoogle(writeBehavior,token,sheetId,sheetName,data){return sheetName=sheetName||DefaultSheetName,await ensureSheetExists(token,sheetId,sheetName),writeBehavior==="append"?appendToGoogleSheet(token,sheetId,sheetName,data):overwriteGoogleSheet(token,sheetId,sheetName,data)}async function createGoogleSheetInGoogle(token,sheetOptions){let data={properties:{title:sheetOptions.filename??void 0},sheets:[{properties:{title:sheetOptions.sheetName??DefaultSheetName}}]};return fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${token}`},body:JSON.stringify(data)}).then(document2=>document2.json()).then(document2=>document2??null)}async function updateListOfGoogleSheetsEntry(sheetData){return updateGoogleSheetsData(sheetData)}async function getListOfGoogleSheets(){return getAllSheetData()}async function logCreatedGoogleSheet(sheetData){return addGoogleSheetsData(sheetData)}async function logScrapedGoogleSheet(sheetData){return sheetData===null?Promise.resolve():addOrUpdateGoogleSheetsDataFromScrape(sheetData)}async function clearListOfGoogleSheets(){return clearAllGoogleSheetsData()}async function getSheetDataForInstanceId(instanceId){let matchingSheets=(await getListOfGoogleSheets()).filter(sheet=>sheet.instanceId===instanceId);return matchingSheets.length>0?matchingSheets[0]:null}async function getSheetDataForIds(sheetId,instanceId){let matchingSheets=(await getListOfGoogleSheets()).filter(sheet=>sheet.id===sheetId||instanceId!==void 0&&sheet.instanceId===instanceId);return matchingSheets.length>0?matchingSheets[0]:null}async function writeToGoogleSheet(req){try{maybeAddEntropy();let sheetData=await getSheetDataForIds(req.sheetId,req.instanceId);if(sheetData===null)return Promise.reject(new Error("No sheet found for id/instanceId"));if(req.googleToken===null)try{if(req.googleToken=await getGoogleAuthToken(),!req.googleToken)return Promise.reject(new Error("No google token found"))}catch{return Promise.reject(new Error("No google token found"))}await writeToGoogleSheetInGoogle(req.sheetOptions.writeBehavior??"overwrite",req.googleToken,sheetData.id,req.sheetOptions.sheetName,req.dataArray)}catch(err){return Promise.reject(err)}}async function getOrCreateGoogleSheet(req){try{maybeAddEntropy();let sheetForInstanceId=await getSheetDataForInstanceId(req.instanceId);if(sheetForInstanceId===null){let document2=await createGoogleSheetInGoogle(req.googleToken,req.sheetOptions),sheetData={instanceId:req.instanceId,url:document2.spreadsheetUrl,id:document2.spreadsheetId,title:document2.properties.title,pageTitle:document2.properties.title,deleted:!1,hidden:!1};return await logCreatedGoogleSheet(sheetData),{created:!0,sheetData}}return{created:!1,sheetData:sheetForInstanceId}}catch(err){return Promise.reject(err)}}async function getAllPagingState(){return{pagingStates:await getPagingStatesForAllTabs()}}async function getAllUrlBookmarkState(){return{bookmarks:await getAllUrlBookmarks()}}async function handlePagingDataUpdate(tabId,frameId,request){if(tabId===void 0||frameId===void 0)return;let typedRequest=request,pagingState=await getPagingStateForTabFrame(tabId,frameId);if(pagingState)try{let{dataAttributes,pageCount}=typedRequest;await updatePagingStateForTabFrame(tabId,frameId,{...pagingState,tabId,frameId,dataAttributes,pageCount})}catch(err){swallowError(err,"handlePagingDataUpdate-updatePagingStateForTabFrame")}}async function handlePagingListenPreStart(tabId,frameId,request){if(tabId===void 0||frameId===void 0)return;let typedRequest=request,{pagingState:partialPagingState}=typedRequest,pagingState=await getOrCreatePagingStateForTabFrame(tabId,frameId,"classic",partialPagingState);updatePagingStateForTabFrame(tabId,frameId,{...pagingState,tabId,frameId,paging:!0})}async function handlePagingListenStart(tabId,frameId,request){if(tabId===void 0||frameId===void 0)return;let typedRequest=request,{pagingState:partialPagingState}=typedRequest,pagingState=await getOrCreatePagingStateForTabFrame(tabId,frameId,"classic",partialPagingState);updatePagingStateForTabFrame(tabId,frameId,{...pagingState,tabId,frameId,paging:!0})}function handlePagingListenStop(tabId,frameId){tabId===void 0||frameId===void 0||(clearPagingContinuationState(),clearPagingState(tabId))}async function handleAutoPagingUpdate(tabId,frameId,request){if(tabId===void 0||frameId===void 0)return;let pagingState=await getPagingStateForTabFrame(tabId,frameId);if(pagingState){let autoPageTable=request.autoPageTable;updatePagingStateForTabFrame(tabId,frameId,{...pagingState,tabId,frameId,autoPageTable})}}function sendMessageToFrame(tabId,frameId,params){return new Promise(resolve=>{chrome.tabs.sendMessage(tabId,params,{frameId},response=>{hasRuntimeError()?checkLogLastError(">> sendMessageToFrame: Error caught |>"):resolve({tabId,frameId,response})})})}async function checkHistoryStatePaging(tabId,frameId,url){if(tabId===void 0||frameId===void 0||!await getPagingStateForTabFrame(tabId,frameId)||await hasPagingContinuationForUrl(url))return;await setPagingContinuationForUrl(url,!0);let params={action:"PAGING_CONTINUATION_PAGE_REFRESH"};sendMessageToFrame(tabId,frameId,params)}function checkPaging(tabId){tabId!==void 0&&getPagingStatesForTab(tabId).then(async pagingStates=>{if(!pagingStates||pagingStates.length===0)return;let userConfig=await getCachedExtensionUserConfig("check-paging");if(!userConfig)return;let continuationKey=`continue-paging-Tab:${tabId}`;pagingStates.forEach(pagingState=>{let frameId=pagingState.frameId;DEV_DEBUG_FINE&&console.log(`checkPaging (${continuationKey}), Frame: ${frameId}`);let params={action:"PAGING_CONTINUATION",pagingState,userConfig,continuationKey};sendMessageToFrame(tabId,Number(frameId),params)})}).catch(err=>swallowError(err,"checkPaging-getCachedExtensionUserConfig"))}async function handleBookmarkDynamicPaging(tabId,frameId,req){if(tabId===void 0||frameId===void 0)return;let typedRequest=req,url=typedRequest.bookmarkUrl;bookmarkPagingStateForUrl(url,typedRequest.pagingState)}function initInstallHandling(){chrome.runtime.onInstalled.addListener(details=>{details.reason==="install"&&(openNewOptionsPage("install=1"),saveInstallDate())}),chrome.runtime.setUninstallURL(UNINSTALL_URL),getInstallDate().then(installDate=>{let niceInstallDate="";installDate&&(niceInstallDate=getYYYYMMDD(new Date(installDate)));let uninstallUrl=`${UNINSTALL_URL}?dun=${niceInstallDate}&ver=${CurrentVersion}`;chrome.runtime.setUninstallURL(uninstallUrl)}).catch(err=>swallowError(err,"getInstallDate"))}async function periodicallyClean(){Math.random()<.1&&clearAllOldBookmarks()}async function requestIdentityPermissions(){return requestOptionalPermissions(["identity"])}async function requestOptionalPermissions(permissions){return new Promise((resolve,reject)=>{chrome.permissions.request({permissions},granted=>{if(hasRuntimeError())return reject(getRuntimeError());resolve(granted)})})}function isBackgroundActionLoggable(action){return["SHEET_SYNC_CREATE","SHEET_SYNC_WRITE"].includes(action)}initCachedExtensionUserConfig();initContextMenus();initInstallHandling();periodicallyClean();chrome.tabs.onActivated.addListener(({tabId})=>{DEV_DEBUG_FINE&&console.log(`tabs.onActivated (tabId: ${tabId})`),updateContextMenus(tabId)});chrome.webNavigation.onBeforeNavigate.addListener(({tabId})=>{});chrome.webNavigation.onCompleted.addListener(({tabId,url})=>{checkUrlBasedActions(tabId,url),updateContextMenus(tabId)});chrome.webNavigation.onHistoryStateUpdated.addListener(({frameId,tabId,url})=>{DEV_DEBUG_FINE&&console.log(`webNavigation.onHistoryStateUpdated (tabId: ${tabId}, frameId: ${frameId})`),updateContextMenus(tabId),checkHistoryStatePaging(tabId,frameId,url)});chrome.commands.onCommand.addListener((command,tab)=>{getCachedExtensionUserConfig(`keyboardshortcut-${command}`).then(userConfig=>{if(!(!tab?.id||!userConfig)){if(command==="launch-table-capture-workshop")return sendSelectionWorkshopRequest(tab.id,userConfig,!1);if(command==="launch-inline-actions")return sendDisplayInlineRequest(tab.id,userConfig)}}).catch(err=>swallowError(err,"chrome.commands.onCommand//getCachedExtensionUserConfig"))});chrome.runtime.onUserScriptMessage.addListener((message,sender,sendResponse)=>{let tabId=sender.tab?.id,action=message.action;if(action==="USER_SCRIPT_GET_USER_CONFIG"){sendResponse({userConfig:syncGetCachedExtensionUserConfig()});return}if(tabId&&action==="USER_SCRIPT_SEND_DATA"){let typedRequest=message,recipe=typedRequest.recipe;recipe.id&&recipe.name&&recipe.autoClip&&typedRequest.clip&&saveClipCollectionData({dataArray:typedRequest.data,collection:recipe.id,collectionName:recipe.name,sourceUrl:typedRequest.sourceUrl}),chrome.tabs.sendMessage(tabId,{...message},sendResponse)}else sendResponse({err:`Invalid request: Action = ${action}`})});chrome.runtime.onMessage.addListener((message,sender,sendResponse)=>{if(message&&"url"in message&&message.url)return handleRequestToOpenUrl(message,sender,sendResponse);let tabId=sender.tab?.id,frameId=sender.frameId,action=message.action;if(isBackgroundActionLoggable(action)&&console.log(`background.ts::onMessage:${action}`,message),action==="GET_FRAME_INFO"){let typedRequest=message;return typedRequest.hardRefresh?queryTabForFrameIds(typedRequest.tabId).then(frameIds=>{sendResponse({frameIds}),saveFrameIdsForTab(typedRequest.tabId,frameIds)}).catch(err=>sendResponse({err:err.message})):getFrameIdsForTab(typedRequest.tabId).then(frameIds=>{sendResponse({frameIds})}).catch(err=>sendResponse({err:err.message})),!0}if(action==="REMOVE_DEAD_FRAMES")return removeFrameIdsForTab(message.tabId,message.frameIds),sendResponse({}),!0;if(action==="FRAME_TRACK_CHECK"){let typedRequest=message,{hasTables,topWindow}=typedRequest;return(hasTables||topWindow)&&trackTabFrame(tabId,frameId),sendResponse({}),!0}if(action==="HELLO"){let typedRequest=message;return(typedRequest.tables.length>0||typedRequest.topWindow)&&trackTabFrame(tabId,frameId),logScrapedGoogleSheet(typedRequest.sheetData??null),checkPaging(tabId),updateContextMenus(tabId),sendResponse({}),!0}if(action==="CLIP_COLLECTIONS_DELETE")return clearClipCollectionData().then(()=>sendResponse({})).catch(err=>sendResponse({err:err.message})),!0;if(action==="CLIP_COLLECTION_FETCH_INFO")return getClipCollection(message.collection).then(collection=>{sendResponse({collection})}).catch(err=>sendResponse({err:err.message})),!0;if(action==="CLIP_COLLECTIONS_FETCH")return getClipCollectionData().then(collections=>sendResponse({collections})).catch(err=>sendResponse({err:err.message})),!0;if(action==="EDIT_TABLE")return saveTableAndOpenTableEdit(message.publicTable).then(()=>sendResponse({})).catch(err=>sendResponse({err:err.message})),!0;if(action==="GET_LOCAL_EDITABLE_TABLE")return retrieveActiveEditableTable().then(table=>sendResponse({table})).catch(err=>sendResponse({err:err.message})),!0;if(action==="COPY_TABLE_STRING")return _tcLogRequestAction(message,syncGetCachedExtensionUserConfig()),sendResponse({});if(action==="CLOUD_CTA_FOR_REPRO")return saveActiveCloudTableAndOpenCloudCTA(message).then(()=>sendResponse({})).catch(err=>sendResponse({err:err.message})),!0;if(action==="GET_ACTIVE_CLOUD_TABLE")return getActiveCloudTable().then(repro=>sendResponse({repro})).catch(err=>sendResponse({err:err.message})),!0;if(action==="GET_GOOGLE_AUTH_TOKEN")return getGoogleAuthToken().then(token=>sendResponse({token})).catch(err=>sendResponse({err:err.message})),!0;if(action==="REQUEST_IDENTITY_PERMISSIONS")return requestIdentityPermissions().then(granted=>sendResponse({granted})).catch(err=>sendResponse({err:err.message})),!0;if(action==="SHEET_LIST")return getListOfGoogleSheets().then(sheets=>sendResponse({sheets})).catch(err=>sendResponse({err:err.message})),!0;if(action==="SHEET_LIST_RESET")return clearListOfGoogleSheets(),sendResponse({});if(action==="SHEET_LIST_UPDATE")return updateListOfGoogleSheetsEntry(message.sheetData).then(()=>sendResponse({})).catch(err=>sendResponse({err:err.message})),!0;if(action==="SHEET_SYNC_CREATE")return getOrCreateGoogleSheet(message).then(response=>{sendResponse(response),response.created&&response.sheetData&&createTab({selected:!0,url:response.sheetData.url})}).catch(err=>sendResponse({err:err.message})),!0;if(action==="SHEET_SYNC_WRITE")return writeToGoogleSheet(message).then(()=>sendResponse({cool:"cool"})).catch(err=>sendResponse({err:err.message})),!0;if(action==="CLIP_DATA_SAVE")return saveClipCollectionData(message).then(()=>sendResponse({cool:"cool"})).catch(err=>sendResponse({err:err.message})),!0;if(["SCREENSHOT_VISIBLE_TAB"].includes(action))return sendResponse({err:"Not supported at the moment."}),!0;if(action==="CHECK_FOR_URL_BOOKMARK"){let url=message.bookmarkUrl;return getPagingStateBookmarkForUrl(url).then(pagingState=>{sendResponse({url,pagingState})}).catch(err=>sendResponse({err:err.message})),!0}switch(action){case"BOOKMARK_DYNAMIC_PAGING":handleBookmarkDynamicPaging(tabId,frameId,message);break;case"PAGING_DATA_UPDATE":handlePagingDataUpdate(tabId,frameId,message);break;case"PAGING_LISTEN_PRESTART":handlePagingListenPreStart(tabId,frameId,message);break;case"PAGING_LISTEN_START":handlePagingListenStart(tabId,frameId,message);break;case"PAGING_LISTEN_STOP":handlePagingListenStop(tabId,frameId);break;case"AUTO_PAGING_UPDATE":handleAutoPagingUpdate(tabId,frameId,message);break;case"DEBUG_PAGING_STATE":return getAllPagingState().then(response=>sendResponse(response)).catch(err=>sendResponse({err:err.message})),!0;case"DEBUG_URL_BOOKMARKS":return getAllUrlBookmarkState().then(response=>sendResponse(response)).catch(err=>sendResponse({err:err.message})),!0;default:let errorMessage=`runtime.onMessage::Fall-through (${action})`;return console.log(errorMessage,message),sendResponse({err:errorMessage})}return sendResponse({response:"background.ts::onMessage"}),!0});})();
/*! Bundled license information:

localforage/dist/localforage.js:
  (*!
      localForage -- Offline Storage, Improved
      Version 1.10.0
      https://localforage.github.io/localForage
      (c) 2013-2017 Mozilla, Apache License 2.0
  *)
*/
