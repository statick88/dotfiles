<!DOCTYPE html>
<html lang="en" dir="auto">
  <head></head>
  <body>
    <script>
      function evalCodeWithData(event) {
        const { id, code, data } = event.data;
        try {
          const fn = eval(code);
          const result = fn(data);
          const response = { id, data: result, error: null, success: true };
          window.parent.postMessage(response, window.location.origin);
        } catch (error) {
          const response = {
            id,
            error: `${id} - ${error.message}`,
            success: false,
          };
          window.parent.postMessage(response, window.location.origin);
        }
      }

      function evalCode(event) {
        const { id, code } = event.data;

        try {
          const result = eval(code);
          const response = { id, error: null, success: true };
          window.parent.postMessage(response, window.location.origin);
        } catch (error) {
          const response = {
            id,
            error: `${id} - ${error.message}`,
            success: false,
          };
          window.parent.postMessage(response, window.location.origin);
        }
      }

      // Listen for messages from the parent window
      window.addEventListener("message", (event) => {
        // Only accept messages from the same origin
        if (event.origin !== window.location.origin) {
          return;
        }

        // Evaluate the code and send the result back to the parent window
        const { action } = event.data;
        if (action === "js-evaluate") {
          evalCode(event);
        } else if (action === "js-data-evaluate") {
          evalCodeWithData(event);
        }
      });
    </script>
  </body>
</html>
