window.paywall={isInitialized:!1,paywallId:null,_initPromise:null,_eventHandlers:new Map,_paywallDocumentRoot:null,_observer:null,_overrideStyles:null,init:function(t,e,a){return this._initPromise||(this.paywallId=t,this._paywallDocumentRoot=null!=a?a:document,this._initPromise=new Promise((t=>{this._addEventHandler("init",(e=>{"state"===e.data.type&&e.data.state.hasOwnProperty("visibility_status")&&(this.isInitialized=!0,this._removeEventHandler("init"),t(!0))})),window.addEventListener("message",this._globalEventHandler.bind(this),!1),this._createAndAppendIframe()}))),this._initPromise},_createAndAppendIframe:function(){window.requestAnimationFrame((()=>{let t=()=>{let t=this._paywallDocumentRoot.createElement("iframe");t.src="https://onlineapp.pro/paywall/".concat(this.paywallId,"?v=2"),t.id="paywall-".concat(this.paywallId),t.style.display="none";let e=this._paywallDocumentRoot.body||this._paywallDocumentRoot;e?e.appendChild(t):console.warn("[PAYWALL ERROR] Paywall container not found")};"loading"===this._paywallDocumentRoot.readyState?this._paywallDocumentRoot.addEventListener("DOMContentLoaded",t):t()}))},_globalEventHandler:function(t){let e=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));if(t.source===(null==e?void 0:e.contentWindow))for(let[a,n]of("change-styles"===t.data.type?Object.assign(e.style,{...t.data.style,...this._overrideStyles||{}}):"redirect"===t.data.type?window.open(t.data.redirectUrl):"remove"===t.data.type&&e.remove(),this._eventHandlers))n(t)},_addEventHandler:function(t,e){this._eventHandlers.set(t,e)},_removeEventHandler:function(t){this._eventHandlers.delete(t)},_ensureInitialized:async function(){this.isInitialized||await this._initPromise},open:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{resolveEvent:"opened",paywallContainerId:void 0};return await this._ensureInitialized(),new Promise(((e,a)=>{var n;if(this._addEventHandler("open",(n=>{var i;if("state"===(null===(i=n.data)||void 0===i?void 0:i.type)&&["https://onlineapp.pro","https://onlineapp.live","https://onlineapp.stream"].includes(n.origin))if("invisible"===n.data.state.visibility_status&&"paid"!==n.data.state.purchase_status&&"tokenization-sign-in"!==n.data.state.visibility_status_reason)this._removeEventHandler("open"),a(n.data.state);else switch(t.resolveEvent){case"opened":"visible"===n.data.state.visibility_status&&(this._removeEventHandler("open"),e(n.data.state));break;case"signed-in":"signed-in"===n.data.state.auth_status&&(this._removeEventHandler("open"),e(n.data.state));break;case"success-purchase":"paid"===n.data.state.purchase_status&&(this._removeEventHandler("open"),e(n.data.state))}})),null==t?void 0:t.paywallContainerId){let e=this._paywallDocumentRoot.getElementById(t.paywallContainerId);e?this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId))?(this._updateIframeStyles(e),new ResizeObserver((()=>{this._updateIframeStyles(e)})).observe(e)):console.warn("[PAYWALL ERROR] Paywall iframe not found"):console.warn("[PAYWALL ERROR] Specified container not found")}null===(n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===n||n.contentWindow.postMessage({action:"open"},"*")}))},_updateIframeStyles:function(t){let e=t.getBoundingClientRect(),a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));this._overrideStyles={position:"absolute",top:"".concat(e.top+window.scrollY,"px"),left:"".concat(e.left+window.scrollX,"px"),width:"".concat(e.width,"px"),height:"".concat(e.height,"px")},a?(a.style.position="absolute",a.style.top="".concat(e.top+window.scrollY,"px"),a.style.left="".concat(e.left+window.scrollX,"px"),a.style.width="".concat(e.width,"px"),a.style.height="".concat(e.height,"px")):console.warn("[PAYWALL ERROR] Paywall iframe not found")},renew:async function(){return await this._ensureInitialized(),new Promise(((t,e)=>{var a;this._addEventHandler("renew",(a=>{var n;"state"===(null===(n=a.data)||void 0===n?void 0:n.type)&&["https://onlineapp.pro","https://onlineapp.live","https://onlineapp.stream"].includes(a.origin)&&("paid"===a.data.state.purchase_status?(this._removeEventHandler("renew"),t(a.data.state)):"closed-by-user"===a.data.state.visibility_status_reason&&(this._removeEventHandler("renew"),e(a.data.state)))})),null===(a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)))||void 0===a||a.contentWindow.postMessage({action:"renew"},"*")}))},getUser:async function(){return await this._ensureInitialized(),this.makeRequest("https://onlineapp.pro/api/v1/paywall/".concat(this.paywallId,"/user"))},signOut:async function(){return await this._ensureInitialized(),this.makeRequest("https://onlineapp.pro/api/signout",{method:"POST"})},makeRequest:async function(t,e,a){return await this._ensureInitialized(),new Promise(((n,i)=>{let s=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),l=Date.now();this._addEventHandler("request_".concat(l),(t=>{t.data.requestId===l&&(this._removeEventHandler("request_".concat(l)),t.data.error?i(t.data.error):n(t.data.response))})),null==s||s.contentWindow.postMessage({type:"MAKE_REQUEST",url:t,options:e,requestId:l},"*"),a&&(a.abort=()=>{this._abortRequest(l)})}))},makeStreamRequest:async function*(t,e,a){await this._ensureInitialized();let n=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId)),i=Date.now();this._addEventHandler("stream_".concat(i),(t=>new Promise(((e,a)=>{var n,s;t.data.requestId===i?(null===(s=t.data)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.error)?a(t.data.data.error):e({chunk:t.data.chunk,done:t.data.done}):e(null)})))),null==n||n.contentWindow.postMessage({type:"MAKE_STREAM_REQUEST",url:t,options:e,requestId:i},"*"),a&&(a.abort=()=>{this._abortRequest(i)});try{for(;;){let t=await new Promise(((t,e)=>{this._addEventHandler("stream_message_".concat(i),(a=>{var n,s;a.data.requestId===i&&((null===(s=a.data)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.error)?e(a.data.data.error):t(a.data))}))}));if(t.done)break;t.chunk&&(yield t.chunk)}}finally{this._removeEventHandler("stream_".concat(i)),this._removeEventHandler("stream_message_".concat(i))}},_abortRequest:function(t){var e;let a=this._paywallDocumentRoot.getElementById("paywall-".concat(this.paywallId));null==a||null===(e=a.contentWindow)||void 0===e||e.postMessage({type:"ABORT_REQUEST",requestId:t},"*")}},paywall.init("94");try{chrome.storage.sync.get("installDate",(function(t){t.installDate&&paywall.open()}))}catch(t){console.log(t)}window.addEventListener("message",(function(t){"state"===t.data?.type&&["https://onlineapp.pro","https://onlineapp.live","https://onlineapp.stream"].includes(t.origin)&&"paid"===t.data?.state?.purchase_status&&(document.getElementById("paidPlan").style.display="unset")}));